<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">


<meta http-equiv="X-UA-Compatible" content="IE=edge">

<title>Worker health data for NYC.&#x7c; Environment &amp; Health Data Portal</title>


<meta name="description" content="Here is the site global SEO description">
<link rel="canonical" href="https://nychealth.github.io/EH-dataportal/data-explorer/worker-health/" />
<meta name="robots" content="all" />
<meta name="geo.region" content="" />
<meta name="geo.placename" content="Environment &amp; Health Data Portal" />


<meta property="fb:profile_id" content="0" />
<meta property="og:type" content="website" />
<meta property="og:locale" content="en_us" />
<meta property="og:url" content="https://nychealth.github.io/EH-dataportal/data-explorer/worker-health/" />
<meta property="og:title" content="Worker health data for NYC.&ndash; Environment &amp; Health Data Portal" />
<meta property="og:description" content="Explore data, visualizations, and more." />
<meta property="og:site_name" content="Environment &amp; Health Data Portal" />
<meta property="og:image" content="https://nychealth.github.io/EH-dataportal/images/report_bottom_background_hu55023dbc37de342337a21cf33dcc5889_222582_2400x1260_fill_q75_box_smart1.jpg"><meta property="og:see_also" content="https://twitter.com/nycHealthy" />
<meta name="twitter:title" content="Worker health data for NYC.&ndash; Environment &amp; Health Data Portal">
<meta name="twitter:description" content="Explore data, visualizations, and more.">
<meta name="twitter:image" content="/images/report_bottom_background.jpg">
<meta name="twitter:site" content="@nycHealthy">
<meta name="twitter:creator" content="@nycHealthy">
<script src="https://code.jquery.com/jquery-3.3.1.min.js" 
    integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" 
    crossorigin="anonymous"></script>


<link rel="stylesheet" href="../../fontawesome/css/all.min.css">

<link rel="stylesheet" href="https://nychealth.github.io/EH-dataportal/scss/theme.css" />


<script src="https://cdn.jsdelivr.net/npm/dompurify@2.3.10/dist/purify.min.js" 
    integrity="sha256-keaR/uWEpEmmUnoJ6BemH9gp9Ng8u/YplhVwdmmquNY=" 
    crossorigin="anonymous"></script>

</head>
<body>
  
  
<a class="sr-only sr-only-focusable skip-menu" href="#skip-header-target">Skip Header</a>

<header id="global-header" role="banner">

    <div class="bg-black text-white" id="nyc-top-header">

        <div class="container-fluid wide">

            <div class="row py-1 align-items-center justify-content-between">

                <div class="col-auto">
                    <p class="d-none d-md-flex fs-md">
                        <a class="text-reset" href="https://www1.nyc.gov/">
                            <strong>nyc.gov</strong>
                        </a>
                        <span class="mx-1" aria-hidden="true">|</span>
                        Health
                    </p>
                </div>
                

                <div class="col-auto">

                    <ul class="extensible-list horizontal fs-md">
                        <li>
                            <a class="text-reset" href="https://www1.nyc.gov/">
                                <strong>
                                    311
                                </strong>
                            </a>
                        </li>
                        <li>
                            <a class="text-reset" href="https://www1.nyc.gov/home/search/index.page">
                                <strong>
                                    Search all NYC.gov
                                </strong>
                            </a>
                        </li>
                        <li>
                            <a href="https://www1.nyc.gov/" title="Go to nyc.gov">
                                <img class="d-block" src="../../images/nyc-bubble-logo.svg" width="45" alt="NYC Logo">
                            </a>
                        </li>
                    </ul>

                </div>
                

            </div>
            

        </div>
        

    </div>
    
    <div class="site-header bg-primary" style="background-image: url(/EH-dataportal/images/header_background.jpg)">
        <div class="wrap-header">

            <div class="container-fluid wide">

                <div class="row align-items-center">

                    <div class="col-lg py-4 pl-md-5">

                        <div class="d-flex justify-content-center justify-content-lg-start">

                            <p class="text-white">
                                <span class="site-title">Environment and Health Data Portal</span>
                                <span class="site-subtitle">Explore data on how environments shape health in New York
                                    City</span>
                            </p>


                        </div>
                        

                    </div>
                    

                    <div class="col-lg-auto border-top border-lg-0">

                        <div class="row no-gutters justify-content-between py-2">

                            
                            <div class="col-auto d-flex d-lg-none">

                                <button class="no-btn-style" type="button" data-toggle="collapse"
                                    data-target="#nav-primary" aria-controls="nav-primary" aria-expanded="false"
                                    aria-label="Toggle navigation">
                                    <span class="fas fa-bars fa-lg"></span>
                                </button>

                            </div>
                            

                            <div class="col-auto">

                                <ul class="extensible-list horizontal">
                                    <li>
                                        <button class="no-btn-style" type="button" title="Language"
                                            data-toggle="collapse" data-target="#global-language"
                                            aria-controls="global-language" aria-expanded="false">
                                            <span class="sr-only">Language</span>
                                            <span class="fas fa-language fa-2x"></span>
                                        </button>
                                    </li>
                                    <li>
                                        <button class="no-btn-style" type="button" title="Search" data-toggle="collapse"
                                            data-target="#global-search" aria-controls="global-search"
                                            aria-expanded="false">
                                            <span class="sr-only">Search</span>
                                            <span class="fas fa-search fa-lg"></span>
                                        </button>
                                    </li>
                                </ul>

                            </div>
                            

                        </div>
                        

                    </div>
                    

                </div>
                

            </div>
            

        </div>
        

        <div class="container-fluid border-top collapse" id="global-language">
            <div class="narrow py-2">
                <div id="google_translate_element"></div>
            </div>
        </div>

        <div class="container-fluid border-top collapse" id="global-search">
            <form class="narrow py-2" aria-label="Search" role="search">
                <div class="input-group">
                    <label class="sr-only" for="global-search-bar">Search</label>
                    <input class="form-control form-control-lg" id="global-search-bar" placeholder="Search">
                    <div class="input-group-btn">
                        <button class="btn btn-primary btn-lg" type="button" title="Search">
                            <span class="sr-only">Search</span>
                            <span class="fas fa-arrow-right"></span>
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <div class="container-fluid collapse d-lg-block px-0 border-lg-top" id="nav-primary">

        <div class="wide"> 

            <nav class="nav nav-pills border-bottom" role="navigation"><div class="nav-item">

                    <a class="nav-link" href="../../" id="nav-item-01">
                        <span class='text-primary'><i class='fa fa-home' aria-hidden='true'></i></span> Home
                    </a>

                </div>
                <div class="nav-item">

                    <a class="nav-link" href="../../data-stories/" id="nav-item-02">
                        <span class='text-primary'><i class='fas fa-passport' aria-hidden='true'></i></span> Data Stories
                    </a>

                </div>
                <div class="nav-item">

                    <a class="nav-link" href="../../neighborhood-reports/" id="nav-item-04">
                        <span class='text-primary'><i class='fas fa-map-marked-alt' aria-hidden='true'></i></span> Neighborhood Reports
                    </a>

                </div>
                <div class="nav-item">

                    <a class="nav-link" href="../../key-topics/" id="nav-item-05">
                        <span class='text-primary'><i class='fas fa-star' aria-hidden='true'></i></span> Key Topics
                    </a>

                </div>
                <div class="nav-item active">

                    <a class="nav-link" href="../../data-explorer/" id="nav-item-03">
                        <span class='text-primary'><i class='fas fa-chart-line' aria-hidden='true'></i></span> Data Explorer
                    </a>

                </div>
                </nav>

        </div>
        

    </div>

</header>
<main id="skip-header-target" role="main">

<style>
     

     
    #vg-tooltip-element table tr {
        border-bottom: 1px solid #d9d9d9;
        
    }    
     
    #vg-tooltip-element table tr:last-child {
        border-bottom: 0px;
    }
    
     
    #vg-tooltip-element table tr td.key {
        font-size: 12px!important;
        color: #505050;
        border-right: 1px solid #d9d9d9;
        text-align: right;
        padding-right: 10px;
        width: max-content;
    }    
    
     
    #vg-tooltip-element table tr td.value {
        font-size: 12px!important;
        color: black;
        text-align: left;
        padding-left: 10px;
        width: max-content;
    }

     
    #summary-table table thead tr th {
        font-size: 13px!important;
    }

</style>

<article class="container-fluid" id="skip-header-target">
    <div class="row">
        <div class="col-md-11 mx-auto mt-4 mx-1">
            <nav aria-label="breadcrumb" class="mb-2">
                <ul class="breadcrumb mr-auto">
                    <li class="breadcrumb-item"><a href="https://nychealth.github.io/EH-dataportal/">Home</a></li>
                    <li class="breadcrumb-item"><a href="https://nychealth.github.io/EH-dataportal//data-explorer/">Data Explorer</a></li>
                    <li class="breadcrumb-item active"><a href="../../data-explorer/worker-health/">Worker health</a></li>
                    <li class="nav-item ml-auto">
                        <button type="button" class="btn btn-sm btn-outline-primary" data-toggle="modal"
                                data-target="#topicModal">
                            Change topic
                        </button>

                        

                    </li>
                </ul>
            </nav>

            <div class="row mb-1">
                <div class="col mx-2 ml-0 pl-0 py-2">
                    <h2>Worker health</h2>
                </div>
            </div>

            <style>
                 
                [aria-expanded="false"]>.expanded,
                [aria-expanded="true"]>.collapsed {
                    display: none;
                }

                #truncate {
                    display: block;
                }

                #full {
                    display: none;
                }

                #expand-collapse {
                    cursor: pointer;
                }

                .show {
                    display: block !important;
                }

                .hide {
                    display: none !important;
                }

                 

                .dropdown-title {
                    padding: 0.25rem 1.5rem;
                }

                .indicator-measures h6 {
                    margin-top: 0.5em;
                }

                .dropdown-menu {
                    z-index: 2000;
                }



                div[aria-labelledby="dropdownMapMeasures"].show {
                    display: flex !important;
                }
            </style>

            <style>
                .topic-text {
                    font-size: 12px!important;
                }

                .topic-text h3 {
                    font-size: 16px;
                    color: #656565;
                }

                .topic-text p li {
                    font-size: 12px;
                }
            </style>

            <div class="row">
                <div class="col-md-4">

                    <div class="card content-card mb-2">
                        <div class="card-content">
                            <div class="card-body topic-text">
                                <span class='home-label d-none d-md-block border-bottom mb-1'>About this topic</span>
                                 <p>Every year in New York City, workers are injured on the job or become ill as a result of exposure to health hazards at work. However, <strong>most work-related illnesses and injuries are preventable</strong> –  safer work environments can be achieved when workplace hazards are understood and appropriate prevention measures are put in place.</p>
<p>Data on work-related injuries and illness are used to show how often these preventable events occur and to identify  factors that place workers at risk. These data are also used to design, target and evaluate prevention strategies and regulations that aim to keep workers safe and healthy.</p>
<h3 id="work-workplaces-and-health">Work, Workplaces and Health</h3>
<p>High-quality work benefits physical and mental health in a variety of ways. In addition to economic benefits, work can be a source of identity and pride, an avenue for social participation and a way to learn new skills. Individuals who work have lower rates of illness and live longer than those who are unemployed. On the other hand, unfavorable work environments expose workers to serious health hazards which regularly result in injury, illness, disability and death.</p>
<p>Although many factors contribute to worker health, such as workplace design, organization, worker characteristics and culture, it is the employer’s responsibility to provide safe and healthful workplaces for their workers.</p>
<h3 id="preventing-workplace-injury-and-disease">Preventing Workplace Injury and Disease</h3>
<p>Both workers and employers play important roles in keeping workplaces safe and healthy.</p>
<p><strong>Employers should:</strong></p>
<ul>
<li>Demonstrate and communicate an ongoing commitment to safety and wellbeing.</li>
<li>Eliminate known hazards if possible and design work processes and environments to minimize exposure.</li>
<li>Ask workers or their representatives what safety and health issues are most important to them and act on their concerns.</li>
<li>Provide safety and health education and resources to all workers.</li>
</ul>
<p><strong>Workers should:</strong></p>
<ul>
<li>Communicate concerns about potential hazards to their employer in a timely manner.</li>
<li>Follow established work safety practices, such as wearing recommended personal protective equipment and following safety protocols.</li>
</ul>

                            </div>

                        </div>


                    </div>
                </div>

                <div class="col-md-8">
                    
                    <button class="btn btn-sm btn-outline-light text-primary btn-block d-block d-md-none mt-0 mb-2"
                            type="button" data-toggle="modal" data-target="#aboutModal">
                        About Worker health
                    </button>

                    <div class="card content-card topic-text">
                        <div class="card-content">
                            <div class="card-body">
                                <div class="dropdown">
                                    <span class='home-label d-block'>Change dataset</span>
            
                                    <button class="btn btn-outline-primary btn-block dropdown-toggle" type="button"
                                            id="dropdownIndicator" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        More Worker health data
                                    </button>
                                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownIndicator"
                                         id="indicator-dropdown">
                                        
                                    </div>
                                </div>
            
            
                                <div style="clear:both" class="my-2">
                                    <span class="home-label d-block">About <span id="indicatorTitle">Indicator</span></span>
            
                                    <p class="fs-sm indicator-description"></p>
                                </div>
                            </div>

                        </div>


                    </div>

                    <div class="card content-card mt-1">
                        <div class="card-content">
                            <div class="card-body">
                                <div class="mt-2">
                                    <div class="nav nav-pills bg-white device-xs" role="tablist">
            
                                        <a class="nav-item nav-link flex-fill" id="tab-btn-table" href="#tab-table" data-toggle="pill"
                                           aria-controls="tab-table" aria-selected="false" role="tab">
                                            <i class="fas fa-list fa-fw"></i>
                                            <div class="d-none  d-lg-inline-block py-1">Summary</div>
                                        </a>
                
                                        <a class="nav-item nav-link flex-fill" id="tab-btn-map" href="#tab-map" data-toggle="pill"
                                           aria-controls="tab-map" aria-selected="false" role="tab">
                                            <i class="fas fa-map-marker-alt fa-fw"></i>
                                            <div class="d-none d-lg-inline-block py-1">Map</div>
                                        </a>
                
                                        <a class="nav-item nav-link flex-fill" id="tab-btn-trend" href="#tab-trend" data-toggle="pill"
                                           aria-controls="tab-trend" aria-selected="false" role="tab">
                                            <i class="fas fa-chart-line fa-fw"></i>
                                            <div class="d-none  d-lg-inline-block py-1">Trend</div>
                                        </a>
                
                
                                        <a class="nav-item nav-link flex-fill" id="tab-btn-links" href="#tab-links" data-toggle="pill"
                                           aria-controls="tab-links" aria-selected="false" aria-disabled="true" role="tab">
                                            <i class="fas fa-link fa-fw"></i>
                                            <div class="d-none  d-lg-inline-block py-1">Links</div>
                                        </a>
                
                                    </div>
                
                                    <div class="tab-content bg-white mb-4" id="tabs-01-content">
                                        
                                        <div class="tab-pane fade show active py-2" id="tab-table" aria-labelledby="tab-btn-table"
                                             role="tabpanel">
                                            <div class="float right mr-1">
                                                <div class="dropdown">
                                                    <button class="btn btn-sm float-right btn-outline-success dropdown-toggle"
                                                            type="button" id="dropdownTableYear" data-toggle="dropdown"
                                                            aria-haspopup="true" aria-expanded="false">Select year
                                                    </button>
                                                    <div class="dropdown-menu" aria-labelledby="dropdownTableYear">
                                                        
                                                    </div>
                                                </div>
                
                                                <div class="dropdown">
                                                    <button class="btn btn-sm mr-1 float-right btn-outline-success dropdown-toggle"
                                                            type="button" id="dropdownTableGeo" data-toggle="dropdown"
                                                            aria-haspopup="true" aria-expanded="false">Select
                                                        geography
                                                    </button>
                                                    <div class="dropdown-menu" aria-labelledby="dropdownTableGeo">
                                                        
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="mt-4">
                                                <span id="summaryTitle" class="home-label"></span>
                                                <div id="summary-table">
                                                    
                                                </div>
                
                                            </div>
                                        </div>
                                        
                                        <div class="tab-pane fade py-2" id="tab-map" aria-labelledby="tab-btn-map" role="tabpanel">
                                            <div class="float right mr-1">
                                                <div class="dropdown">
                                                    <button class="btn btn-sm mr-1 float-right btn-outline-success dropdown-toggle"
                                                            type="button" id="dropdownMapMeasures" data-toggle="dropdown"
                                                            aria-haspopup="true" aria-expanded="false">Select
                                                        measure
                                                    </button>
                                                    <div class="dropdown-menu" aria-labelledby="dropdownMapMeasures">
                                                        
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="mt-4">
                                                <span id="mapTitle" class="home-label"></span>
                                                <div id="map" width=600 height=500
                                                     style="width: 100%; min-height: 450px; margin-bottom: 50px;"></div>
                                            </div>
                                        </div>
                                        
                                        <div class="tab-pane fade py-2" id="tab-trend" aria-labelledby="tab-btn-trend" role="tabpanel">
                                            <div class="dropdown float-right mr-1">
                                                <button class="btn btn-sm float-right btn-outline-success dropdown-toggle" type="button"
                                                        id="dropdownTrendMeasures" data-toggle="dropdown" aria-haspopup="true"
                                                        aria-expanded="false">Choose measure</button>
                                                    
                                                    <button class="btn btn-sm mr-1 float-right btn-outline-success btn-show-disparities"
                                                            style="display:inline">Show Dispartites</button>
                                                
                                                <div class="dropdown-menu" aria-labelledby="dropdownTrendMeasures">
                                                    
                                                </div>
                                            </div>
                                            <div class="mt-4">
                                                <span id="trendTitle" class="home-label"></span>
                                                
                                                <div id="trend" style="width: 100%; height: 550px"></div>
                                            </div>
                                        </div>
                                        
                                        <div class="tab-pane fade py-2" id="tab-links" aria-labelledby="tab-btn-links" role="tabpanel">
                                            <div class="dropdown float-right">
                                                <button class="btn btn-sm float-right btn-outline-success dropdown-toggle" type="button"
                                                        id="dropdownLinksMeasures" data-toggle="dropdown" aria-haspopup="true"
                                                        aria-expanded="false">Select data to link
                                                </button>
                                                <div class="dropdown-menu" aria-labelledby="dropdownLinksMeasures">
                                                    
                                                </div>
                                            </div>
                                            <div class="mt-4" style="height: 550px; clear: both">
                                                <span id="linksTitle" class="home-label"></span>
                                                
                                                <div id="links" style="width: 100%"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>





                    <hr class="my-2">


                    <div class="row my-2">
                        <div class="col-md-4">
                            <div class="dropdown">
                                <button class="btn btn-sm btn-outline-light text-secondary" type="button"
                                        id="downloadDD" onclick="runDataDownload()"><i
                                       class="fa fa-download mr-1"></i>Download Data
                                </button>
                            </div>
                        </div>



                        <div class="col-md-4 ml-auto">
                            <button class="btn float-right btn-sm btn-outline-light text-secondary"
                                    onclick="copyCitation()" id="citeButton"><i class="fas fa-copy mr-1"></i>Copy
                                citation</button>
                            <input type="text" id="citeText" value=""
                                   style="display:inline-block; width:100%; height: 40px; font-size: 14px;"
                                   class="my-2 sr-only">
                        </div>
                    </div>

                    <div class="row mb-4">
                        <div class="col-md-6 col-xs-12">
                            <div class="btn-toggle">
                                <button class="btn btn-block btn-md btn-outline-light text-secondary"
                                        data-toggle="collapse" data-target="#toggle-target" aria-expanded="false"
                                        aria-controls="toggle-target">
                                    <span class="title"><i class="fas fa-info-circle mr-1"></i>About the Measures</span>
                                </button>
                            </div>

                            <div class="collapse p-2" id="toggle-target" role="navigation">
                                <p class="fs-sm indicator-measures">Insert from `How_Calculated.` Vivamus consequat id
                                    nibh et tempor. Cras
                                    augue enim, iaculis quis purus sit amet, interdum accumsan neque. In blandit varius
                                    blandit. Praesent
                                    vel leo ac urna dapibus faucibus. Donec sed luctus neque. Nulla porta finibus elit,
                                    luctus eleifend
                                    felis ornare vitae. Ut consequat laoreet libero eu venenatis.</p>

                            </div>
                        </div>
                        <div class="col-md-6 col-xs-12">
                            <div class="btn-toggle">
                                <button class="btn btn-block btn-md btn-outline-light text-secondary"
                                        data-toggle="collapse" data-target="#toggle-target-2" aria-expanded="false"
                                        aria-controls="toggle-target-2">
                                    <span class="title"><i class="fas fa-database mr-1"></i>Data sources</span>
                                </button>
                            </div>

                            <div class="collapse p-2" id="toggle-target-2" role="navigation">
                                <p class="fs-sm indicator-sources">Insert from `Sources.` Pellentesque blandit ante vel
                                    augue mattis, lacinia
                                    tincidunt velit feugiat. Class aptent taciti sociosqu ad litora torquent per conubia
                                    nostra, per inceptos
                                    himenaeos. Donec nulla nisl, sollicitudin et volutpat at, finibus ac quam.
                                    Pellentesque faucibus turpis
                                    egestas tellus luctus, nec porttitor diam bibendum. Sed mauris augue, tempus id urna
                                    sit amet, hendrerit
                                    blandit libero. Cras sit amet luctus nunc, nec mattis leo. </p>

                            </div>
                        </div>

                    </div>

                    
                    <div class="row mb-4">
                        <div class="col">
                                <p style="font-size:10px">
                                    <em>* Estimate is based on small numbers so should be interpreted with caution.<br>
                                        ** Estimate is suppressed due to insufficient data.</em>
                                    </p>
    
                        </div>
                    </div>

                </div>
            </div>

        </div>
    </div>

    

    
    <div class="modal fade" id="topicModal" tabindex="-1" role="dialog" aria-labelledby="topicModalLabel"
         aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="topicModalLabel">Change topic</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body px-0">
                    <style>
    .accordion-group .card {
        background-color: #f2f2f2;
        margin: 0px;
    }

</style>




<div class="row no-gutters">
    <div class="col-12">

        <div class="accordion-group narrow fs-sm" role="tablist" id="accordion-01">

            <div class="card">

               <strong><a class="card-header bg-light collapse collapsed"
                    id="acc-button-01" data-toggle="collapse"
                    href="#panel-acc-button-01" role="tab"
                    aria-expanded="false"
                    aria-controls="panel-acc-button-01">
                    <span class="title" role="heading"
                        aria-level="3">Air Quality</span>
                </a></strong> 

                <div class="collapse" id="panel-acc-button-01"
                    role="tabpanel" aria-labelledby="acc-button-01"
                    data-parent="#accordion-01">

                    <div class="card-body">
                        <ul>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/active-design/">Active design</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/air-quality/">Air quality</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/asthma/">Asthma</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/health-impacts-of-air-pollution/">Health impacts of air pollution</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/walking-driving-and-cycling/">Walking, driving, and cycling</a>
                                </li>
                            
                            </ul>
                    </div>

                </div>
                

            </div>
            

            <div class="card">

                <strong><a class="card-header bg-light collapse collapsed"
                    id="acc-button-02" data-toggle="collapse"
                    href="#panel-acc-button-02" role="tab"
                    aria-expanded="false"
                    aria-controls="panel-acc-button-02">
                    <span class="title" role="heading"
                        aria-level="3">Climate</span>
                </a></strong>

                <div class="collapse" id="panel-acc-button-02"
                    role="tabpanel" aria-labelledby="acc-button-02"
                    data-parent="#accordion-01">

                    <div class="card-body">
                        <ul>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/asthma/">Asthma</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/climate/">Climate</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/housing-safety/">Housing safety</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/housing-stability/">Housing stability</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/vector-borne-disease/">Vector-borne disease</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/weather-related-illness/">Weather-related illness</a>
                                </li>
                            
                            </ul>
                    </div>

                </div>
                

            </div>
            

            <div class="card">

               <strong> <a class="card-header bg-light collapse collapsed"
                    id="acc-button-03" data-toggle="collapse"
                    href="#panel-acc-button-03" role="tab"
                    aria-expanded="false"
                    aria-controls="panel-acc-button-03">
                    <span class="title" role="heading"
                        aria-level="3">Housing</span>
                </a></strong>

                <div class="collapse" id="panel-acc-button-03"
                    role="tabpanel" aria-labelledby="acc-button-03"
                    data-parent="#accordion-01">

                    <div class="card-body">
                        <ul>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/asthma/">Asthma</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/asthma-triggers/">Asthma triggers at home</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/bed-bugs/">Bed bugs</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/cancer/">Cancer</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/carbon-monoxide-incidents/">Carbon monoxide</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/cigarette-smoke/">Cigarette smoke</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/cockroaches/">Cockroaches</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/economic-conditions/">Economic conditions</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/falls-among-older-adults/">Falls among older adults</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/housing-maintenance/">Housing maintenance</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/housing-safety/">Housing safety</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/housing-stability/">Housing stability</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/lead/">Lead poisoning</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/mice-and-rats/">Mice and rats</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/social-conditions/">Social conditions</a>
                                </li>
                            
                            </ul>
                    </div>

                </div>
                

            </div>
            

            <div class="card">

                <strong><a class="card-header bg-light collapse collapsed"
                    id="acc-button-04" data-toggle="collapse"
                    href="#panel-acc-button-04" role="tab"
                    aria-expanded="false"
                    aria-controls="panel-acc-button-04">
                    <span class="title" role="heading"
                        aria-level="3">Health equity</span>
                </a></strong>

                <div class="collapse" id="panel-acc-button-04"
                    role="tabpanel" aria-labelledby="acc-button-04"
                    data-parent="#accordion-01">

                    <div class="card-body">
                        <ul>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/asthma/">Asthma</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/asthma-triggers/">Asthma triggers at home</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/economic-conditions/">Economic conditions</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/health-care/">Health care</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/health-impacts-of-air-pollution/">Health impacts of air pollution</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/housing-maintenance/">Housing maintenance</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/housing-safety/">Housing safety</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/housing-stability/">Housing stability</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/lead/">Lead poisoning</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/mortality/">Mortality</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/social-conditions/">Social conditions</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/violence/">Violence</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/weather-related-illness/">Weather-related illness</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/worker-health/">Worker health</a>
                                </li>
                            
                            </ul>
                    </div>

                </div>
                

            </div>
            

            <div class="card">

                <strong><a class="card-header bg-light collapse collapsed"
                    id="acc-button-05" data-toggle="collapse"
                    href="#panel-acc-button-05" role="tab"
                    aria-expanded="false"
                    aria-controls="panel-acc-button-05">
                    <span class="title" role="heading"
                        aria-level="3">Active design / Transportation</span>
                </a></strong>

                <div class="collapse" id="panel-acc-button-05"
                    role="tabpanel" aria-labelledby="acc-button-05"
                    data-parent="#accordion-01">

                    <div class="card-body">
                        <ul>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/active-design/">Active design</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/air-quality/">Air quality</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/asthma/">Asthma</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/health-impacts-of-air-pollution/">Health impacts of air pollution</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/physical-activity/">Physical activity</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/transportation-related-injuries/">Transportation-related injuries</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/walking-driving-and-cycling/">Walking, driving, and cycling</a>
                                </li>
                            
                            </ul>
                    </div>

                </div>
                

            </div>
            

            <div class="card">

                <strong><a class="card-header bg-light collapse collapsed"
                    id="acc-button-06" data-toggle="collapse"
                    href="#panel-acc-button-06" role="tab"
                    aria-expanded="false"
                    aria-controls="panel-acc-button-06">
                    <span class="title" role="heading"
                        aria-level="3">Health outcomes</span>
                </a></strong>

                <div class="collapse" id="panel-acc-button-06"
                    role="tabpanel" aria-labelledby="acc-button-06"
                    data-parent="#accordion-01">

                    <div class="card-body">
                        <ul>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/asthma/">Asthma</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/birth-defects/">Birth defects</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/birth-outcomes/">Birth outcomes</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/cancer/">Cancer</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/cancers-in-children/">Cancers in children</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/falls-among-older-adults/">Falls among older adults</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/health-impacts-of-air-pollution/">Health impacts of air pollution</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/mortality/">Mortality</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/overweight/">Overweight</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/transportation-related-injuries/">Transportation-related injuries</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/vector-borne-disease/">Vector-borne disease</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/violence/">Violence</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/weather-related-illness/">Weather-related illness</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/worker-health/">Worker health</a>
                                </li>
                            
                            </ul>
                    </div>

                </div>
                

            </div>
            

            <div class="card">

                <strong><a class="card-header bg-light collapse collapsed"
                    id="acc-button-07" data-toggle="collapse"
                    href="#panel-acc-button-07" role="tab"
                    aria-expanded="false"
                    aria-controls="panel-acc-button-07">
                    <span class="title" role="heading"
                        aria-level="3">Child health</span>
                </a></strong>

                <div class="collapse" id="panel-acc-button-07"
                    role="tabpanel" aria-labelledby="acc-button-07"
                    data-parent="#accordion-01">

                    <div class="card-body">
                        <ul>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/air-quality/">Air quality</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/asthma/">Asthma</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/birth-defects/">Birth defects</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/birth-outcomes/">Birth outcomes</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/cancers-in-children/">Cancers in children</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/carbon-monoxide-incidents/">Carbon monoxide</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/cigarette-smoke/">Cigarette smoke</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/lead/">Lead poisoning</a>
                                </li>
                            
                            </ul>
                    </div>

                </div>
                

            </div>
            

            <div class="card">

                <strong><a class="card-header bg-light collapse collapsed"
                    id="acc-button-08" data-toggle="collapse"
                    href="#panel-acc-button-08" role="tab"
                    aria-expanded="false"
                    aria-controls="panel-acc-button-08">
                    <span class="title" role="heading"
                        aria-level="3">Pests and pesticides</span>
                </a></strong>

                <div class="collapse" id="panel-acc-button-08"
                    role="tabpanel" aria-labelledby="acc-button-08"
                    data-parent="#accordion-01">

                    <div class="card-body">
                        <ul>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/asthma/">Asthma</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/bed-bugs/">Bed bugs</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/cockroaches/">Cockroaches</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/mice-and-rats/">Mice and rats</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/pesticides/">Pesticides</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/vector-borne-disease/">Vector-borne disease</a>
                                </li>
                            
                            </ul>
                    </div>

                </div>
                

            </div>
            

            <div class="card">

                <strong><a class="card-header bg-light collapse collapsed"
                    id="acc-button-09" data-toggle="collapse"
                    href="#panel-acc-button-09" role="tab"
                    aria-expanded="false"
                    aria-controls="panel-acc-button-09">
                    <span class="title" role="heading"
                        aria-level="3">Food and drink</span>
                </a></strong>

                <div class="collapse" id="panel-acc-button-09"
                    role="tabpanel" aria-labelledby="acc-button-09"
                    data-parent="#accordion-01">

                    <div class="card-body">
                        <ul>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/healthy-eating/">Healthy eating</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/alcohol-use/">Alcohol access and use</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/drinking-water-quality/">Drinking water quality</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/restaurant-food-safety/">Restaurant food safety</a>
                                </li>
                            
                            </ul>
                    </div>

                </div>
                

            </div>
            

            <hr class="my-2">

            <div class="card">

                <strong><a class="card-header bg-light collapse collapsed"
                    id="acc-button-10" data-toggle="collapse"
                    href="#panel-acc-button-10" role="tab"
                    aria-expanded="false"
                    aria-controls="panel-acc-button-10">
                    <span class="title" role="heading"
                        aria-level="3">All topics</span>
                </a></strong>

                <div class="collapse" id="panel-acc-button-10"
                    role="tabpanel" aria-labelledby="acc-button-10"
                    data-parent="#accordion-01">

                    <div class="card-body">
                        <ul>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/healthy-eating/">Healthy eating</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/active-design/">Active design</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/air-quality/">Air quality</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/alcohol-use/">Alcohol access and use</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/all-data/">All data sets</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/asthma/">Asthma</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/asthma-triggers/">Asthma triggers at home</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/bed-bugs/">Bed bugs</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/birth-defects/">Birth defects</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/birth-outcomes/">Birth outcomes</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/cancer/">Cancer</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/cancers-in-children/">Cancers in children</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/carbon-monoxide-incidents/">Carbon monoxide</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/cigarette-smoke/">Cigarette smoke</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/climate/">Climate</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/cockroaches/">Cockroaches</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/drinking-water-quality/">Drinking water quality</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/economic-conditions/">Economic conditions</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/falls-among-older-adults/">Falls among older adults</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/health-care/">Health care</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/health-impacts-of-air-pollution/">Health impacts of air pollution</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/housing-maintenance/">Housing maintenance</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/housing-safety/">Housing safety</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/housing-stability/">Housing stability</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/lead/">Lead poisoning</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/mice-and-rats/">Mice and rats</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/mortality/">Mortality</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/overweight/">Overweight</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/pesticides/">Pesticides</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/physical-activity/">Physical activity</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/restaurant-food-safety/">Restaurant food safety</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/social-conditions/">Social conditions</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/transportation-related-injuries/">Transportation-related injuries</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/vector-borne-disease/">Vector-borne disease</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/violence/">Violence</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/walking-driving-and-cycling/">Walking, driving, and cycling</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/weather-related-illness/">Weather-related illness</a>
                                </li>
                            
                                <li><a href="https://nychealth.github.io/EH-dataportal/data-explorer/worker-health/">Worker health</a>
                                </li>
                            
                            </ul>
                    </div>

                </div>
                

            </div>
            

        </div>
        
    </div>
</div>


<script>
    var subtopic_indicators = {"active-design":{"IndicatorID":[2390,2181,2158,2157,2143,2388,2391,2389,2133],"subtopic_name":"Active design"},"air-quality":{"IndicatorID":[92,57,55,2024,2023,2028,2025,2027,2026],"subtopic_name":"Air quality"},"alcohol-use":{"IndicatorID":[2049,2057,2050,2051,2056,2055],"subtopic_name":"Alcohol access and use"},"asthma":{"IndicatorID":[2380,2384,2048,2378,2379,2383,2382,2387,84,2381,2386,18,2392,2147,2149,2339],"subtopic_name":"Asthma"},"asthma-triggers":{"IndicatorID":[2101,25,2393,2394,107,48],"subtopic_name":"Asthma triggers at home"},"bed-bugs":{"IndicatorID":[2030],"subtopic_name":"Bed bugs"},"birth-defects":{"IndicatorID":[26,30,31,36,37,33,28,32,35,27,101,29,34],"subtopic_name":"Birth defects"},"birth-outcomes":{"IndicatorID":[5,4,6,7,8,1,9,3,2],"subtopic_name":"Birth outcomes"},"cancer":{"IndicatorID":[74,2096,66,60,770,2077,2087,2088,73,2089,63,2090,2095,71,2091,64,690],"subtopic_name":"Cancer"},"cancers-in-children":{"IndicatorID":[2037,2035,2033,2031,2039],"subtopic_name":"Cancers in children"},"carbon-monoxide-incidents":{"IndicatorID":[38,2168,2398,2405,2406],"subtopic_name":"Carbon monoxide"},"cigarette-smoke":{"IndicatorID":[2338,2020,2017,2019,2021,25],"subtopic_name":"Cigarette smoke"},"climate":{"IndicatorID":[2141,2143,2084,2191,2411,2155,2104,2185,2377],"subtopic_name":"Climate"},"cockroaches":{"IndicatorID":[22,2393,107],"subtopic_name":"Cockroaches"},"drinking-water-quality":{"IndicatorID":[2207,2044,2043,2041],"subtopic_name":"Drinking water quality"},"economic-conditions":{"IndicatorID":[103,2176,2337,2132,2317,2073,17,2336,15,2365],"subtopic_name":"Economic conditions"},"falls-among-older-adults":{"IndicatorID":[2135,2136,2408,2409,2403,2188],"subtopic_name":"Falls among older adults"},"health-care":{"IndicatorID":[2151,2132,2401,2232],"subtopic_name":"Health care"},"health-impacts-of-air-pollution":{"IndicatorID":[2122,2124,2121,2117,2120,2108,2119],"subtopic_name":"Health impacts of air pollution"},"healthy-eating":{"IndicatorID":[2097,2389,2098],"subtopic_name":"Healthy eating"},"housing-maintenance":{"IndicatorID":[2396,2395,46,47,45,40,42,41,2399,2179],"subtopic_name":"Housing maintenance"},"housing-safety":{"IndicatorID":[2188,2185,2377],"subtopic_name":"Housing safety"},"housing-stability":{"IndicatorID":[2365,15,17,2336],"subtopic_name":"Housing stability"},"lead":{"IndicatorID":[2189,2184,2216,2176,2209,41,16],"subtopic_name":"Lead poisoning"},"mice-and-rats":{"IndicatorID":[2394,2105,24,48],"subtopic_name":"Mice and rats"},"mortality":{"IndicatorID":[5,6,8,2322],"subtopic_name":"Mortality"},"overweight":{"IndicatorID":[2063,2064,2061,2062],"subtopic_name":"Overweight"},"pesticides":{"IndicatorID":[2235,91,100,2312,96,94,93,99,97,98,102,2366,2364,2367,2368,2369,2374,2370],"subtopic_name":"Pesticides"},"physical-activity":{"IndicatorID":[2060,2058,2173,2059,2172],"subtopic_name":"Physical activity"},"restaurant-food-safety":{"IndicatorID":[2065],"subtopic_name":"Restaurant food safety"},"social-conditions":{"IndicatorID":[2325,2145,14,2334,2317,2335,2146,2323],"subtopic_name":"Social conditions"},"transportation-related-injuries":{"IndicatorID":[2092,2086,2094,2093],"subtopic_name":"Transportation-related injuries"},"vector-borne-disease":{"IndicatorID":[2218,2340],"subtopic_name":"Vector-borne disease"},"violence":{"IndicatorID":[2400,2375],"subtopic_name":"Violence"},"walking-driving-and-cycling":{"IndicatorID":[2133,2172,2058,2173,2059,2236,2237,2238,2113,2114,2112],"subtopic_name":"Walking, driving, and cycling"},"weather-related-illness":{"IndicatorID":[2376,2175,2174,2410,2084,2074,2075,2076,2191,2411],"subtopic_name":"Weather-related illness"},"worker-health":{"IndicatorID":[2209,2211,2208,2210,2214,2239,2215],"subtopic_name":"Worker health"}};
    

    var destination = document.getElementById('indicatorNames')    

    function changeKT(x) {
        console.log(x)
        const all = document.querySelectorAll('.dumps')
        all.forEach((dump) => {
            dump.classList.remove('show')
            dump.classList.add('hide')
        });
        const chosen = 'output'+x
        console.log('chosen: ' + chosen)
        document.getElementById(chosen).classList.remove('hide')

        const KTs = document.querySelectorAll('.kt')
        KTs.forEach((kt) => {
            kt.classList.remove('active')
        });

        const link = 'kt'+x
        document.getElementById(link).classList.add('active')
    }

</script>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    
    <div class="modal fade" id="aboutModal" tabindex="-1" role="dialog" aria-labelledby="aboutModalLabel"
         aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="aboutModalLabel">About Worker health</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p>Every year in New York City, workers are injured on the job or become ill as a result of exposure to health hazards at work. However, <strong>most work-related illnesses and injuries are preventable</strong> –  safer work environments can be achieved when workplace hazards are understood and appropriate prevention measures are put in place.</p>
<p>Data on work-related injuries and illness are used to show how often these preventable events occur and to identify  factors that place workers at risk. These data are also used to design, target and evaluate prevention strategies and regulations that aim to keep workers safe and healthy.</p>
<h3 id="work-workplaces-and-health">Work, Workplaces and Health</h3>
<p>High-quality work benefits physical and mental health in a variety of ways. In addition to economic benefits, work can be a source of identity and pride, an avenue for social participation and a way to learn new skills. Individuals who work have lower rates of illness and live longer than those who are unemployed. On the other hand, unfavorable work environments expose workers to serious health hazards which regularly result in injury, illness, disability and death.</p>
<p>Although many factors contribute to worker health, such as workplace design, organization, worker characteristics and culture, it is the employer’s responsibility to provide safe and healthful workplaces for their workers.</p>
<h3 id="preventing-workplace-injury-and-disease">Preventing Workplace Injury and Disease</h3>
<p>Both workers and employers play important roles in keeping workplaces safe and healthy.</p>
<p><strong>Employers should:</strong></p>
<ul>
<li>Demonstrate and communicate an ongoing commitment to safety and wellbeing.</li>
<li>Eliminate known hazards if possible and design work processes and environments to minimize exposure.</li>
<li>Ask workers or their representatives what safety and health issues are most important to them and act on their concerns.</li>
<li>Provide safety and health education and resources to all workers.</li>
</ul>
<p><strong>Workers should:</strong></p>
<ul>
<li>Communicate concerns about potential hazards to their employer in a timely manner.</li>
<li>Follow established work safety practices, such as wearing recommended personal protective equipment and following safety protocols.</li>
</ul>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    
    <script src="https://cdn.jsdelivr.net/npm/arquero@latest"></script>

    
    <link rel="stylesheet" href="https://cdn.datatables.net/1.12.1/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.1.0/css/buttons.dataTables.min.css">

    
    <script src="https://cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.1.0/js/dataTables.buttons.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js" 
        integrity="sha512-oaT4uVdyleJGVHZqklOx2Bb8WhOTBW3iCXRtgk3+YutYmFx0jSs97UR3/+r1vh1Isyb3GOGjFonLbS6LFiiEVA==" 
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js" 
        integrity="sha512-guWTt6syHB4T9gdPdw8W1iQUGqqricRt5VRjnjgMPpOhUhwOsxmXpk2SImqfcPgsiroK00z/loICebflVeJvqg==" 
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js" 
        integrity="sha512-vv3EN6dNaQeEWDcxrKPFYSFba/kgm//IUnvLPMPadaUf5+ylZyx4cKxuc4HdBf0PPAlM7560DV63ZcolRJFPqA==" 
        crossorigin="anonymous"></script>
    <script src="https://cdn.datatables.net/buttons/2.1.0/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.1.0/js/buttons.print.min.js"></script>
    <script src="https://cdn.datatables.net/rowgroup/1.1.4/js/dataTables.rowGroup.min.js"></script>

    
    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>

    
    <script src="https://d3js.org/d3.v5.min.js"></script>

    
    <script src="../../js/data-explorer/summary.js"></script>
    <script src="../../js/data-explorer/map.js"></script>
    <script src="../../js/data-explorer/trend.js"></script>
    <script src="../../js/data-explorer/links.js"></script>
    <script src="../../js/data-explorer/disparities.js"></script>

    <script>

        
        
        let data_branch = "staging";
        let data_repo = "https://raw.githubusercontent.com/nychealth/EHDP-data";
        let indicators = []; 
        let defaultIndicatorId;
        let selectedSummaryYears = [];
        let selectedSummaryGeography = [];
        let aboutMeasures;
        let dataSources;
        
        let measureAbout = `N/A`;
        let measureSources = `N/A`;
        let geoTable;
        let aqData;
        let joinedAqData;
        
        let fullDataTableObjects;
        let fullDataMapObjects;
        let fullDataTrendObjects;
        let fullDataLinksObjects;
        let joinedDataLinksObjects;
        let disparitiyData; 
        
        let indicator;
        let indicatorName;
        let indicatorDesc;
        let indicatorShortName;
        let indicatorMeasures;
        let indicatorId;
        
        let primaryIndicatorName;
        let secondaryIndicatorName;
        
        let defaultTrendMetadata = [];
        let defaultTrendAbout;
        let defaultTrendSources;
        let defaultMapMetadata = [];
        let defaultMapAbout;
        let defaultMapSources;
        let defaultLinksMetadata = [];
        let defaultLinkMeasureTimes = [];
        let defaultLinksAbout;
        let defaultLinksSources;
        
        let selectedMapMeasure;
        let selectedTrendMeasure;
        let selectedLinksMeasure;
        let selectedMapAbout;
        let selectedMapSources;
        let selectedTrendAbout;
        let selectedTrendSources;
        let selectedLinksAbout;
        let selectedLinksSources;
        let selectedlinksSecondaryMeasureTime;

        let primaryMeasureMetadata;
        let secondaryMeasureMetadata;

        let filteredMapData;
        let filteredTrendData;
        let filteredLinksData;
        
        let mapMeasures = [];
        let trendMeasures = [];
        let linksMeasures = [];
        
        let tabTable;
        let tabMap;
        let tabTrend;
        let tabLinks;
        
        let showTable;
        let showMap;
        let showTrend;
        let showLinks;
        
        
        let currentHash;

        

        
        let tabTrendDropDown = document.querySelector('#tab-trend .dropdown');
        
        
        let btnShowDisparities = document.querySelector('.btn-show-disparities');

        
        
        const url = new URL(window.location);
        
        const updateChartPlotSize = () => {
            setTimeout(() => {
                window.dispatchEvent(new Event('resize'));
            }, 200)
            
        }
        
        

        let hashchange = new Event('hashchange');
        
        window.onpopstate = function (event) {
            if (event.state != null){
                
                document.url = event.state.url;
                
                loadIndicator(event.state.id, true)
            }
        };
        
        window.addEventListener("hashchange", function () {
        
            

            const hash = window.location.hash.replace('#', "");
            
            
            switch (hash) {

                

                case 'display=summary':
                case 'tab-table':
                    
                    $('#tab-btn-table').tab('show');
                    showTable();
                    break;

                case 'display=map':
                case 'tab-map':
                    
                    $('#tab-btn-map').tab('show');
                    showMap();
                    break;

                case 'display=trend':
                case 'tab-trend':
                    
                    $('#tab-btn-trend').tab('show');
                    showTrend();
                    break;

                case 'display=links':
                case 'tab-links':
                    
                    $('#tab-btn-links').tab('show');
                    showLinks();
                    break;

                default:
                    
                    
                    $('#tab-btn-table').tab('show');
                    showTable();
                    break;
            }

            currentHash = hash;

        });

        
        document.addEventListener("DOMContentLoaded", () => {

            tabTable = document.querySelector('#tab-btn-table');
            tabMap = document.querySelector('#tab-btn-map');
            tabTrend = document.querySelector('#tab-btn-trend');
            tabLinks = document.querySelector('#tab-btn-links');

            aboutMeasures = document.querySelector('.indicator-measures');
            dataSources = document.querySelector('.indicator-sources');

        });
        
        function reveal() {
            document.getElementById('truncate').classList.toggle('hide');
            document.getElementById('full').classList.toggle('show');
            document.getElementById('contenttoggle').innerHTML = `Show less... <i class="fas fa-caret-square-up" aria-hidden="true"></i>`;
        }

        
        
        
        const assignGeoRank = (GeoType) => {
            switch (GeoType) {
                case 'Citywide':
                    return 0;
                case 'Borough':
                    return 1;
                case 'NYCKIDS':
                    return 2;
                case 'UHF34':
                    return 3;
                case 'UHF42':
                    return 4;
                case 'Subboro':
                    return 5;
                case 'CD':
                    return 6;
                case 'NTA':
                    return 7;
            }
        }        

        
        
        

        fetch(data_repo + "/" + data_branch + '/indicators/indicators.json')
            .then(response => response.json())
            .then(async data => {

                // console.log("** fetch indicators.json");

                indicators = data;

                // console.log("indicators [fetch]", indicators);

                const paramId = url.searchParams.get('id') !== null ? parseInt(url.searchParams.get('id')) : false;
                
                const renderIndicatorDropdown = () => {
                    const indicatorDropdown = document.getElementById("indicator-dropdown");
                    let indicatorId;
                    let header;
                    
                    
                        header = ``;
                        indicatorDropdown.innerHTML += header.length ? `<div class="dropdown-title"><strong>${header}</strong></div>`: '';
                        
                            
                                defaultIndicatorId = 2209
                            
                            indicatorId = 2209
                            indicator = indicators.find(indicator => indicator.IndicatorID === indicatorId);
                            indicatorName = indicator?.IndicatorName ? indicator.IndicatorName : 'N/A';
                            indicatorDropdown.innerHTML += `<button class="dropdown-item" onclick="loadIndicator(${indicatorId})" data-indicator-id="${indicatorId}">${indicatorName}</button>`
                        
                            
                            indicatorId = 2211
                            indicator = indicators.find(indicator => indicator.IndicatorID === indicatorId);
                            indicatorName = indicator?.IndicatorName ? indicator.IndicatorName : 'N/A';
                            indicatorDropdown.innerHTML += `<button class="dropdown-item" onclick="loadIndicator(${indicatorId})" data-indicator-id="${indicatorId}">${indicatorName}</button>`
                        
                            
                            indicatorId = 2208
                            indicator = indicators.find(indicator => indicator.IndicatorID === indicatorId);
                            indicatorName = indicator?.IndicatorName ? indicator.IndicatorName : 'N/A';
                            indicatorDropdown.innerHTML += `<button class="dropdown-item" onclick="loadIndicator(${indicatorId})" data-indicator-id="${indicatorId}">${indicatorName}</button>`
                        
                            
                            indicatorId = 2210
                            indicator = indicators.find(indicator => indicator.IndicatorID === indicatorId);
                            indicatorName = indicator?.IndicatorName ? indicator.IndicatorName : 'N/A';
                            indicatorDropdown.innerHTML += `<button class="dropdown-item" onclick="loadIndicator(${indicatorId})" data-indicator-id="${indicatorId}">${indicatorName}</button>`
                        
                            
                            indicatorId = 2214
                            indicator = indicators.find(indicator => indicator.IndicatorID === indicatorId);
                            indicatorName = indicator?.IndicatorName ? indicator.IndicatorName : 'N/A';
                            indicatorDropdown.innerHTML += `<button class="dropdown-item" onclick="loadIndicator(${indicatorId})" data-indicator-id="${indicatorId}">${indicatorName}</button>`
                        
                            
                            indicatorId = 2239
                            indicator = indicators.find(indicator => indicator.IndicatorID === indicatorId);
                            indicatorName = indicator?.IndicatorName ? indicator.IndicatorName : 'N/A';
                            indicatorDropdown.innerHTML += `<button class="dropdown-item" onclick="loadIndicator(${indicatorId})" data-indicator-id="${indicatorId}">${indicatorName}</button>`
                        
                            
                            indicatorId = 2215
                            indicator = indicators.find(indicator => indicator.IndicatorID === indicatorId);
                            indicatorName = indicator?.IndicatorName ? indicator.IndicatorName : 'N/A';
                            indicatorDropdown.innerHTML += `<button class="dropdown-item" onclick="loadIndicator(${indicatorId})" data-indicator-id="${indicatorId}">${indicatorName}</button>`
                        
                    
                }
                
                renderIndicatorDropdown()

                // calling loadIndicator calls loadData, etc, and eventually renderMeasures. Because all 
                //  of this depends on the global "indicator" object, we call loadIndicator here
                
                if (paramId) {
                    await loadIndicator(paramId)
                } else {
                    await loadIndicator()
                }
                
            })
            .catch(error => console.log(error));
        
        
        // ======================================================================= //
        // data loading and manipulation functions
        // ======================================================================= //

        // I reversed the order of these function declarations to make the process
        //  of data creation easier to understand
        
        // ----------------------------------------------------------------------- //
        // function to load indicator metadata
        // ----------------------------------------------------------------------- //

        const loadIndicator = (indicatorId, bypassUrlChange) => {

            // console.log("window.location.hash 1 [loadIndicator]", window.location.hash);
            currentHash = window.location.hash;

            // console.log("** loadIndicator");

            // if indicatorId isn't given, use the first indicator from the dropdown list 
            //  (which is populated by Hugo reading the content frontmatter). This comes in as
            //  a string, so "find" uses '==' instead of '==='

            const firstIndicatorId = document.querySelectorAll('#indicator-dropdown button')[0].getAttribute('data-indicator-id');

            indicatorId = indicatorId ? indicatorId : firstIndicatorId;
            
            indicator = indicators.find(indicator => indicator.IndicatorID == indicatorId);
            indicatorName = indicator?.IndicatorName ? indicator.IndicatorName : '';
            indicatorDesc = indicator?.IndicatorDescription ? indicator.IndicatorDescription : '';
            indicatorShortName = indicator?.IndicatorShortname ? indicator.IndicatorShortname : indicatorName;
            indicatorMeasures = indicator?.Measures;

            //create Citation

            createCitation(); // re-runs on updating Indicator
            
            // send Indicator Title to vis headers


            document.getElementById('summaryTitle').innerHTML = indicatorName;
            document.getElementById('mapTitle').innerHTML     = indicatorName;
            document.getElementById('trendTitle').innerHTML   = indicatorName;
            // document.getElementById('linksTitle').innerHTML   = indicatorName; // Handled by VL spec

            // reset selected measure flags

            selectedMapMeasure = false;
            selectedTrendMeasure = false;
            selectedLinksMeasure = false;            
            
            // console.log("window.location.hash 2 [loadIndicator]", window.location.hash);

            if (!bypassUrlChange) {
                url.searchParams.set('id', indicatorId);
                url.hash = window.location.hash;
                window.history.pushState({ id: indicatorId , hash: window.location.hash}, '', url);
            }
            
            // console.log("window.location.hash 3 [loadIndicator]", window.location.hash);

            // call data loading function

            loadData(indicatorId)

            const indicatorTitle = document.getElementById('dropdownIndicator')

            indicatorTitle.innerHTML = indicatorName
        }

        // ----------------------------------------------------------------------- //
        // function to Load indicator data and create Arquero data frame
        // ----------------------------------------------------------------------- //
        
        const loadData = (indicatorId) => {
            
            // console.log("window.location.hash [loadData]", window.location.hash);
            // console.log("** loadData");

            fetch(data_repo + "/" + data_branch + `/indicators/data/${indicatorId}.json`)
            .then(response => response.json())
            .then(async data => {

                // call the geo file loading function

                loadGeo();

                // console.log("data [loadData]", data);
                
                ful = aq.from(data)
                    .derive({ "GeoRank": aq.escape( d => assignGeoRank(d.GeoType))})
                    .groupby("Time", "GeoType", "GeoID", "GeoRank")
                
                
                aqData = ful
                    .groupby("Time", "GeoType", "GeoID")
                    .orderby(aq.desc('Time'), 'GeoRank')
            })
        }

        // ----------------------------------------------------------------------- //
        // function to load geographic data
        // ----------------------------------------------------------------------- //

        const loadGeo = () => {

            // console.log("window.location.hash [loadGeo]", window.location.hash);

            const geoUrl = data_repo + "/" + data_branch + `/geography/GeoLookup.csv`; // col named "GeoType"
            
            aq.loadCSV(geoUrl)
                .then(data => {
                    
                    geoTable = data.select(aq.not('Lat', 'Long'));
                    
                    // call the data-to-geo joining function
                    
                    joinData();
                
            });
        }

        // ----------------------------------------------------------------------- //
        // function to join indicator data and geo data
        // ----------------------------------------------------------------------- //

        const joinData = () => {

            // console.log("window.location.hash [joinData]", window.location.hash);

            // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - //
            // get metadata fields
            // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - //

            // flatten MeasureID + TimeDescription
            
            let availableTimes = [];

            // create table column header with display type

            let measurementDisplay = [];


            indicatorMeasures.map(
            
                measure => {

                    let aqAvailableTimes = 
                        aq.from(measure.AvailableTimes)
                        .derive({MeasureID: `${measure.MeasureID}`})
                    
                    availableTimes.push(aqAvailableTimes);

                    let aqMeasurementDisplay = 
                        aq.table(
                        {
                            MeasureID: [measure.MeasureID], 
                            MeasurementType: [measure.MeasurementType], 
                            DisplayType: [measure.DisplayType]
                        })
                    
                    measurementDisplay.push(aqMeasurementDisplay);

                }
            )
            
            // bind rows of Arquero tables in arrays

            let aqMeasureIdTimes     = availableTimes.reduce((a, b) => a.concat(b))
            let aqMeasurementDisplay = measurementDisplay.reduce((a, b) => a.concat(b))
            
            // console.log("aqMeasurementDisplay");
            // aqMeasurementDisplay.print()

            // console.log("aqMeasureIdTimes [joinData]");
            // aqMeasureIdTimes.print()

            // foundational joined dataset

            joinedAqData = aqData
                .join_left(geoTable, [["GeoID", "GeoType"], ["GeoID", "GeoType"]])
                .rename({'Name': 'Geography'})
                .join(aqMeasureIdTimes, [["MeasureID", "Time"], ["MeasureID", "TimeDescription"]])
                .select(
                    "GeoID", 
                    "GeoType", 
                    "GeoRank", 
                    "Geography", 
                    "MeasureID",
                    "Time", 
                    "Value", 
                    "DisplayValue", 
                    "CI",
                    "start_period",
                    "end_period"
                )
                .orderby(aq.desc('end_period'), aq.desc('GeoRank'))
                .reify()

            // data for summary table

            fullDataTableObjects = joinedAqData
                .join_left(aqMeasurementDisplay, "MeasureID")
                .derive({ 
                    MeasurementDisplay: d => op.trim(op.join([d.MeasurementType, d.DisplayType], " ")),
                    DisplayCI: d => op.trim(op.join([d.DisplayValue, d.CI], " "))
                })
                .derive({ DisplayCI: d => op.replace(d.DisplayCI, /^$/, "-") }) // replace missing with "-"
                .select(aq.not("start_period", "end_period"))
                .objects()

            // console.log("fullDataTableObjects", fullDataTableObjects);

            // data for map
            
            fullDataMapObjects = joinedAqData
                .filter(d => !op.match(d.GeoType, /Citywide|Borough/)) // remove Citywide and Boro
                .impute({ Value: () => NaN })
                .objects()

            // map for trend chart

            fullDataTrendObjects = joinedAqData
                .filter(d => op.match(d.GeoType, /Citywide|Borough/)) // keep only Citywide and Boro
                .objects()

            // data for links & disparities chart

            fullDataLinksObjects = joinedAqData
                .filter(d => !op.match(d.GeoType, /Citywide|Borough/)) // remove Citywide and Boro
                .objects()
            
            // call the measure rendering etc. function

            renderMeasures();
            
        }
        
        
        // ----------------------------------------------------------------------- //
        // function to create data and metadata for links chart
        // ----------------------------------------------------------------------- //
        
        const filterSecondaryIndicatorMeasure = async (primaryMeasureId, secondaryMeasureId) => {

            // console.log("window.location.hash [filterSecondaryIndicatorMeasure]", window.location.hash);

            // console.log("** filterSecondaryIndicatorMeasure");

            // filter links data to keep primary measure
            
            const primaryMeasureTimesDataObjects = fullDataLinksObjects.filter(
                d => d.MeasureID === primaryMeasureId
            );
            
            // get most recent time period for primary measure

            const aqFilteredPrimaryMeasureTimesData = aq.from(fullDataLinksObjects)

                // most recent period in the data
                .filter(`d => d.MeasureID === ${primaryMeasureId}`)

                // most recent period in the data
                .filter(d => d.end_period === op.max(d.end_period))

            // console.log("aqFilteredPrimaryMeasureTimesData", aqFilteredPrimaryMeasureTimesData);

            const mostRecentPrimaryMeasureStartTime = aqFilteredPrimaryMeasureTimesData.array("start_period")[0]
            const mostRecentPrimaryMeasureEndTime   = aqFilteredPrimaryMeasureTimesData.array("end_period")[0]
            const mostRecentPrimaryMeasureTime      = aqFilteredPrimaryMeasureTimesData.array("Time")[0]
            const primaryMeasureGeoRanks            = [...new Set(aqFilteredPrimaryMeasureTimesData.array("GeoRank"))]

            // console.log("mostRecentPrimaryMeasureTime", mostRecentPrimaryMeasureTime);
            // console.log("mostRecentPrimaryMeasureStartTime", mostRecentPrimaryMeasureStartTime);
            // console.log("mostRecentPrimaryMeasureEndTime", mostRecentPrimaryMeasureEndTime);
            // console.log("primaryMeasureGeoRanks", primaryMeasureGeoRanks);
            
            // const filteredPrimaryMeasureTimesDataObjects = aqFilteredPrimaryMeasureTimesData.objects()

            
            // get metadata for the selected primary measure, assign to global variable
            // indicatorMeasures created in loadIndicator
            
            primaryMeasureMetadata = linksMeasures.filter(
                measure => measure.MeasureID === primaryMeasureId
            )

            // if no secondary measure ID is given, set it to the first in the primary measure's links list

            if (typeof secondaryMeasureId == "undefined") {
                secondaryMeasureId = primaryMeasureMetadata[0].VisOptions[0].Links[0].MeasureID;
            }

            // get the indicator element for the selected secondary measure
            
            const secondaryIndicator = indicators.filter(
                indicator => indicator.Measures.some(
                    measure => measure.MeasureID === secondaryMeasureId
                )
            )
            
            // get secondary indicatorID, to get secondary data
            
            const secondaryIndicatorId = secondaryIndicator[0].IndicatorID
            
            // get metadata for the selected secondary measure, assign to global variable
            
            secondaryMeasureMetadata = 
                secondaryIndicator[0].Measures.filter(
                measure => measure.MeasureID === secondaryMeasureId
            )
            
            // get most recent time period for secondary measure
            
            const secondaryMeasureTimes = secondaryMeasureMetadata[0].AvailableTimes;
            const aqSecondaryMeasureTimes = aq.from(secondaryMeasureTimes);
            
            
            // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - //
            // get secondary data
            // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - //
            
            await fetch(data_repo + "/" + data_branch + `/indicators/data/${secondaryIndicatorId}.json`)
                .then(response => response.json())
                .then(async data => {

                    // get secondary measure data
                    
                    const filteredSecondaryMeasureData = data.filter(d => d.MeasureID === secondaryMeasureId)

                    // console.log("filteredSecondaryMeasureData", filteredSecondaryMeasureData);
                    
                    // join with geotable and times
                    
                    const aqFilteredSecondaryMeasureTimesData = aq.from(filteredSecondaryMeasureData)
                        .join(
                            geoTable, 
                            [["GeoID", "GeoType"], ["GeoID", "GeoType"]]
                        )
                        .derive({ "GeoRank": aq.escape( d => assignGeoRank(d.GeoType))})

                        // get same geotypes as primary data (no citywide or boro)
                        .filter(`d => op.includes([${primaryMeasureGeoRanks}], d.GeoRank)`)
                        .rename({'Name': 'Geography'})
                        .join(
                            aqSecondaryMeasureTimes, 
                            ["Time", "TimeDescription"]
                        )
                        .select(aq.not("TimeDescription"))

                    // console.log("aqFilteredSecondaryMeasureTimesData");
                    // aqFilteredSecondaryMeasureTimesData.print()

                    // convert to JS objects
                    
                    const filteredSecondaryMeasureTimesDataObjects = aqFilteredSecondaryMeasureTimesData.objects();
                    
                    // get the closest secondary end time 
                    
                    const closestSecondaryTime = filteredSecondaryMeasureTimesDataObjects.reduce((prev, curr) => {

                        return (Math.abs(curr.end_period - mostRecentPrimaryMeasureEndTime) < Math.abs(prev.end_period - mostRecentPrimaryMeasureEndTime) ? curr : prev);

                    });

                    // console.log("closestSecondaryTime", closestSecondaryTime);

                    // get closest secondary data 

                    const aqClosestSecondaryData = aqFilteredSecondaryMeasureTimesData

                        // data with the latest end period
                        .filter(`d => d.end_period === ${closestSecondaryTime.end_period}`)

                        // get the finest geo 
                        .filter(d => d.GeoRank === op.max(d.GeoRank))

                        // in case there are two time periods left, get the one that starts the earliest,
                        //  which will be yearly over seasonal
                        .filter(d => d.start_period === op.min(d.start_period))
                    
                    // console.log("closestSecondaryData");
                    // aqClosestSecondaryData.print()
                    
                    
                    // count the number of time periods with this end period (should always be 1)

                    // const secondaryYears =  [...new Set(aqClosestSecondaryData.array("Time"))];
                    // console.log("secondaryYears.length", secondaryYears.length);
                    
                    const aqJoinedPrimarySecondaryData = aqFilteredPrimaryMeasureTimesData
                        .join(
                            aqClosestSecondaryData, 
                            [["GeoID", "GeoType"], ["GeoID", "GeoType"]]
                        )
                    
                    console.log("aqJoinedPrimarySecondaryData");
                    aqJoinedPrimarySecondaryData.print()
                    
                    // set the value of joinedDataLinksObjects, and make sure to wait for it
                    
                    joinedDataLinksObjects = await aqJoinedPrimarySecondaryData.objects();

                    // console.log("joinedDataLinksObjects", joinedDataLinksObjects);

                })
        }
        

        // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - //
        // handler functions for summary table
        // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - //

        const handleYearFilter = (el, indicatorId) => {
            el.addEventListener('change', (e) => {
                if (e.target.checked) {
                    // console.log('checked')
                    selectedSummaryYears = [e.target.value]
                }
                renderTable()
            })
        }
        
        const handleGeoFilter = (el, indicatorId) => {
            el.addEventListener('change', (e) => {
                if (e.target.checked) {
                    selectedSummaryGeography.push(e.target.value)
                } else {
                    selectedSummaryGeography = selectedSummaryGeography.filter(item => item !== e.target.value);
                }
                renderTable()
            })
        }
        
        const handleToggle = () => { 
            
            $('body').off('click', '#summary-table tr.group td');
            $('body').on('click', '#summary-table tr.group td', (e) => {
                const td = $(e.target);
                const tr = td.parent();
                const group = td.data('group');
                const groupLevel = td.data('group-level');
                
                const handleGroupToggle = () => {
                    
                    const subGroupToggle = $(`td[data-year="${group}"][data-group-level="1"]`);
                    const subGroupRow = $(`tr[data-year="${group}"]`);
                    
                    if (subGroupToggle.css('display') === 'none') {
                        subGroupToggle.removeClass('hidden');
                        subGroupRow.removeClass('hidden');
                        td.removeClass('hidden');
                        subGroupToggle.show();
                        subGroupRow.show();
                    } else {
                        subGroupToggle.addClass('hidden');
                        subGroupRow.addClass('hidden');
                        td.addClass('hidden');
                        subGroupToggle.hide();
                        subGroupRow.hide();
                    }
                }
                
                const handleSubGroupToggle = () => {
                    const subDataGroup = tr.next(`tr`).data(`group`);
                    const parentDataGroup = subDataGroup.split('-')[0];
                    const subGroupRow = $(`tr[data-group="${subDataGroup}"]`);
                    const parentGroupToggle = $(`td[data-group="${parentDataGroup}"]`);
                    
                    if (subGroupRow.css('display') == 'none')  {
                        subGroupRow.show();
                        td.removeClass('hidden');
                        subGroupRow.removeClass('hidden');
                        parentGroupToggle.removeClass('hidden');
                    } else {
                        subGroupRow.hide();
                        td.addClass('hidden');
                        subGroupRow.addClass('hidden');
                    }
                }
                
                if (groupLevel === 0) {
                    handleGroupToggle();
                } else {
                    handleSubGroupToggle();
                }
                
            });
        }
        

        // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - //
        // measure info functions
        // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - //

        // Renders the Indicator Title and Description

        const renderTitleDescription = (title, desc) => {

            // console.log("** renderTitleDescription");
            
            const indicatorTitle = document.getElementById('indicatorTitle');
            const indicatorDescription = document.querySelector('.indicator-description');
            indicatorTitle.innerHTML = title;
            indicatorDescription.innerHTML = `${desc}`;
        }
        
        // Renders copy for the About the measures and the Data sources sections

        const renderAboutSources = (about, sources) => {

            aboutMeasures.innerHTML = about;
            dataSources.innerHTML = sources;
        }
        

        // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - //
        // tab update functions
        // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - //

        // ===== map ===== //
        
        const updateMapData = (e) => {

            // ----- handle selection ----- //

            // get meaasureId of selected dropdown element

            const measureId = parseInt(e.target.dataset.measureId);

            // get selected time

            const time = e.target.dataset.time;


            // ----- get metatadata for selected measure ----- //

            const measureMetadata = mapMeasures.filter(m => m.MeasureID == measureId);
            const measurementType = measureMetadata[0].MeasurementType;
            const about           = measureMetadata[0].how_calculated;
            const sources         = measureMetadata[0].Sources;
            const display         = measureMetadata[0].DisplayType;
            

            // ----- set measure info boxes ----- //

            // "indicatorName" is set in loadIndicator
            
            selectedMapAbout   = 
                `<h6>${indicatorName} - ${measurementType}</h6>
                <p>${about}</p>`;

            selectedMapSources = 
                `<h6>${indicatorName} - ${measurementType}</h6>
                <p>${sources}</p>`;
            
            // render measure info boxes

            renderAboutSources(selectedMapAbout, selectedMapSources);
            

            // ----- create dataset ----- //

            // filter map data using selected measure and time

            let mapMeasureData = 
                fullDataMapObjects.filter(
                    obj => obj.MeasureID === measureId && 
                    obj.Time === time
                );
            
            // get the highest GeoRank, then keep just that geo
            
            let maxGeoRank = Math.max(mapMeasureData[0].GeoRank);
            filteredMapData = mapMeasureData.filter(obj => obj.GeoRank === maxGeoRank)

            // ----- render the map ----- //

            renderMap(filteredMapData, measureMetadata);

            updateChartPlotSize();
            
            // allow map to persist when changing tabs

            selectedMapMeasure = true;

        }
        

        // ===== trend ===== //
        
        const updateTrendData = (e) => {
            
            // ----- handle selection ----- //

            // get meaasureId of selected dropdown element

            const measureId = parseInt(e.target.dataset.measureId);


            // ----- get metatadata for selected measure ----- //
            
            // trendMeasures is created by renderMeasures, which evals before this would be called
            const measureMetadata = trendMeasures.filter(m => m.MeasureID == measureId);
            const measurementType = measureMetadata[0].MeasurementType;
            const about           = measureMetadata[0].how_calculated;
            const sources         = measureMetadata[0].Sources;
            const display         = measureMetadata[0].DisplayType;


            // ----- set measure info boxes ----- //

            selectedTrendAbout = 
                `<h6>${indicatorName} - ${measurementType}</h6>
                <p>${about}</p>`;

            selectedTrendSources = 
                `<h6>${indicatorName} - ${measurementType}</h6>
                <p>${sources}</p>`;
            
            // render measure info boxes

            renderAboutSources(selectedTrendAbout, selectedTrendSources);


            // ----- handle disparities button ----- //

            // check if disparities is enabled for this measure
            
            const disparities = 
                measureMetadata[0].VisOptions[0].Trend && 
                measureMetadata[0].VisOptions[0].Trend[0]?.Disparities;

            // hide or how disparities button

            if (disparities == 0) {
                
                // if disparities is disabled, hide the button

                btnShowDisparities.style.display = "none";

                // remove click listener to button that calls renderDisparities

                btnShowDisparities.removeEventListener("click", () => renderDisparities(measureMetadata, 221));
                
            } else if (disparities == 1) {
                
                // if disparities is enabled, show the button

                btnShowDisparities.style.display = "inline";

                // add click listener to button that calls renderDisparities

                btnShowDisparities.addEventListener("click", () => renderDisparities(measureMetadata, 221));
                
            }


            // ----- create dataset ----- //

            // created filtered trend data, to be passed to render function

            filteredTrendData = fullDataTrendObjects.filter(m => m.MeasureID === measureId);


            // ----- render the chart ----- //

            renderTrendChart(filteredTrendData, measureMetadata);

            updateChartPlotSize();                    

            // allow trend chart to persist when changing tabs

            selectedTrendMeasure = true;

        }
        

        // ===== links ===== //
        
        const updateLinksData = async (e) => {

            // ---- handle selection ----- //

            // get meaasureIds of selected dropdown element
            
            const primaryMeasureId = parseInt(e.target.dataset.primaryMeasureId);
            const secondaryMeasureId = parseInt(e.target.dataset.secondaryMeasureId);

            // call filterSecondaryIndicatorMeasure, which creates joinedDataLinksObjects,
            //  primaryMeasureMetadata, secondaryMeasureMetadata
            
            await filterSecondaryIndicatorMeasure(primaryMeasureId, secondaryMeasureId)


            // ----- get metatadata for selected measure ----- //

            // for all indicators, get the ones that are linked to the current indicator
            
            const linksSecondaryIndicator = indicators.filter(
                indicator => indicator.Measures.some(
                    m => m.MeasureID === secondaryMeasureId
                )
            )
            
            // get indicator names, for chart + about & sources

            primaryIndicatorName   = indicatorName // created in loadIndicator
            secondaryIndicatorName = linksSecondaryIndicator[0].IndicatorName

            // extract metadata for about & sources boxes

            const primaryMeasurementType = primaryMeasureMetadata[0].MeasurementType;
            const secondaryMeasurementType = secondaryMeasureMetadata[0].MeasurementType;
            
            const primaryAbout = primaryMeasureMetadata[0].how_calculated;
            const secondaryAbout = secondaryMeasureMetadata[0].how_calculated;

            const primarySources = primaryMeasureMetadata[0].Sources;
            const secondarySources = secondaryMeasureMetadata[0].Sources;


            // ----- set measure info boxes ----- //

            selectedLinksAbout = 
                `<h6>${primaryIndicatorName} - ${primaryMeasurementType}</h6>
                <p>${primaryAbout}</p>
                <h6>${secondaryIndicatorName} - ${secondaryMeasurementType}</h6>
                <p>${secondaryAbout}</p>`;

            selectedLinksSources = 
                `<h6>${primaryIndicatorName} - ${primaryMeasurementType}</h6>
                <p>${primarySources}</p>
                <h6>${secondaryIndicatorName} - ${secondaryMeasurementType}</h6>
                <p>${secondarySources}</p>`;
            
            // render the measure info boxes

            renderAboutSources(selectedLinksAbout, selectedLinksSources);
            

            // ----- create dataset ----- //

            // get the highest GeoRank, then keep just that geo
            
            // let maxGeoRank = Math.max(joinedDataLinksObjects[0].GeoRank);
            // filteredLinksData = joinedDataLinksObjects.filter(obj => obj.GeoRank === maxGeoRank)
            

            // ----- render the chart ----- //

            renderLinksChart(
                joinedDataLinksObjects,
                primaryMeasureMetadata,
                secondaryMeasureMetadata,
                primaryIndicatorName,
                secondaryIndicatorName
            );

            updateChartPlotSize();                    

            // allow links chart to persist when changing tabs

            selectedLinksMeasure = true;

        }

        
        // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - //
        // tab default measure functions
        // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - //

        // ===== map ===== //
        
        const setDefaultMapMeasure = (visArray) => {

            // modified so that defaultMapMetadata is explicitly set, instead of by reference 
            //  through defaultArray

            let defaultArray = [];
            
            const hasAgeAdjustedRate = visArray.filter(measure =>
                measure.MeasurementType.includes('Age Adjusted Rate')
            )
            const hasRate = visArray.filter(measure =>
                measure.MeasurementType.includes('Rate')
            )
            const hasPercent = visArray.filter(measure =>
                measure.MeasurementType.includes('Percent')
            )

            // console.log("hasPercent [setDefaultMapMeasure]", hasPercent);
            
            if (hasAgeAdjustedRate.length) {

                const hasAgeAdjustedRateTotal = hasAgeAdjustedRate.filter(measure => 
                    measure.MeasurementType.includes('Total')
                )
                
                // Set total as default if available
                if (hasAgeAdjustedRateTotal.length) {
                    defaultArray.push(hasAgeAdjustedRateTotal[0]);

                } else {
                    defaultArray.push(hasAgeAdjustedRate[0]);

                }
                
            } else if (hasRate.length) {
                defaultArray.push(hasRate[0]);

            } else if (hasPercent.length) {
                defaultArray.push(hasPercent[0]);

            } else {
                defaultArray.push(visArray[0]);

            }
            
            // assigning to global object

            defaultMapMetadata = defaultArray;

        }
        

        // ===== trend ===== //
        
        const setDefaultTrendMeasure = (visArray) => {
            
            // modified so that defaultTrendMetadata is explicitly set, instead of by reference 
            //  through defaultArray
            
            let defaultArray = [];
            
            if (visArray.length > 0) {

                const hasAgeAdjustedRate = visArray.filter(measure =>
                    measure.MeasurementType.includes('Age Adjusted Rate')
                )
                const hasRate = visArray.filter(measure =>
                    measure.MeasurementType.includes('Rate')
                )
                const hasPercent = visArray.filter(measure =>
                    measure.MeasurementType.includes('Percent')
                )
                

                if (hasAgeAdjustedRate.length) {

                    const hasAgeAdjustedRateTotal = hasAgeAdjustedRate.filter(measure => 
                        measure.MeasurementType.includes('Total')
                    )
                    // Set total as default if available
                    if (hasAgeAdjustedRateTotal.length) {
                        defaultArray.push(hasAgeAdjustedRateTotal[0]);

                    } else {
                        defaultArray.push(hasAgeAdjustedRate[0]);

                    }
                    

                } else if (hasRate.length) {
                    defaultArray.push(hasRate[0]);

                } else if (hasPercent.length) {
                    defaultArray.push(hasPercent[0]);

                } else {
                    defaultArray.push(visArray[0]);

                }
            }
            
            // assigning to global object

            defaultTrendMetadata = defaultArray;
        }
        

        // ===== links ===== //
        
        const setDefaultLinksMeasure = async (visArray) => {

            // modified so that defaultLinksMetadata is explicitly set, instead of by reference 
            //  through defaultArray
            
            let defaultArray = [];
            
            if (visArray.length > 0) {

                const hasAgeAdjustedRate = visArray.filter(measure =>
                    measure.MeasurementType.includes('Age Adjusted Rate')
                )
                const hasRate = visArray.filter(measure =>
                    measure.MeasurementType.includes('Rate')
                )
                const hasPercent = visArray.filter(measure =>
                    measure.MeasurementType.includes('Percent')
                )


                if (hasAgeAdjustedRate.length) {

                    const hasAgeAdjustedRateTotal = hasAgeAdjustedRate.filter(measure =>
                        measure.MeasurementType.includes('Total')
                    )
                    // Set total as default if available
                    if (hasAgeAdjustedRateTotal.length) {
                        defaultArray.push(hasAgeAdjustedRateTotal[0]);

                    } else {
                        defaultArray.push(hasAgeAdjustedRate[0]);
                    }


                } else if (hasRate.length) {
                    defaultArray.push(hasRate[0]);

                } else if (hasPercent.length) {
                    defaultArray.push(hasPercent[0]);

                } else {
                    defaultArray.push(visArray[0]);

                }

                defaultLinkMeasureTimes = defaultArray[0].AvailableTime;
                
                const defaultPrimaryMeasureId = defaultArray[0].MeasureID;
                const defaultSecondaryMeasureId = defaultArray[0].VisOptions[0].Links[0].MeasureID;

                // console.log("defaultSecondaryMeasureId [setDefaultLinksMeasure]", defaultSecondaryMeasureId);
                
                // assigning to global object
                defaultLinksMetadata = defaultArray;

                // using await here because filterSecondaryIndicatorMeasure calls fetch, and we need that data
                
                await filterSecondaryIndicatorMeasure(defaultPrimaryMeasureId, defaultSecondaryMeasureId)
                
            }
        }
        

        // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - //
        // finally, render the measures
        // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - //

        const renderMeasures = async () => {

            // console.log("** renderMeasures");
            
            linksMeasures.length = 0
            
            const contentSummary = document.querySelector('#tab-table');
            const contentMap     = document.querySelector('#tab-map')
            const contentTrend   = document.querySelector('#tab-trend');
            const contentLinks   = document.querySelector('#tab-links');

            // ----- set dropdowns for this indicator ----- //

            const dropdownTableYear = contentSummary.querySelector('div[aria-labelledby="dropdownTableYear"]');
            const dropdownMapMeasures = document.querySelector('div[aria-labelledby="dropdownMapMeasures"]');                        
            
            const dropdownMapYear  = contentMap.querySelector('div[aria-labelledby="dropdownMapYear"]');
            const dropdownTableGeo = contentSummary.querySelector('div[aria-labelledby="dropdownTableGeo"]');
            const dropdownTrendMeasures = contentTrend.querySelector('div[aria-labelledby="dropdownTrendMeasures"]');
            const dropdownLinksMeasures = contentLinks.querySelector('div[aria-labelledby="dropdownLinksMeasures"]');
            
            // clear Measure Dropdowns

            dropdownTableYear.innerHTML = ``;
            dropdownTableGeo.innerHTML = ``;
            dropdownMapMeasures.innerHTML = ``;
            dropdownTrendMeasures.innerHTML = ``;
            dropdownLinksMeasures.innerHTML = ``;
            
            mapMeasures.length = 0;
            trendMeasures.length = 0;

            // create years dropdown for table

            const tableYears = [...new Set(fullDataTableObjects.map(item => item.Time))];
            
            tableYears.forEach((year, index) => {
                
                if (index === 0) {

                    selectedSummaryYears.push(year);
                    dropdownTableYear.innerHTML += 
                        `<label class="dropdown-item checkbox-year"><input type="radio" name="year" value="${year}" checked /> ${year}</label>`;

                } else {

                    dropdownTableYear.innerHTML += 
                        `<label class="dropdown-item checkbox-year"><input type="radio" name="year" value="${year}" /> ${year}</label>`;
                }
                
            });
            
            // create geo dropdown for table

            const tableGeoTypes = [...new Set(fullDataTableObjects.map(item => item.GeoType))];

            tableGeoTypes.forEach((geoType, index) => {
                
                selectedSummaryGeography.push(geoType);
                dropdownTableGeo.innerHTML += `<label class="dropdown-item checkbox-geo"><input type="checkbox" value="${geoType}" checked /> ${geoType}</label>`;
                
            });
            

            // ----- handle measures for this indicator ----- //
            
            const mapYears = [...new Set(fullDataMapObjects.map(item => item.Time))];

            indicatorMeasures.map((measure, index) => {
                
                const type = measure?.MeasurementType;
                const displayType = measure?.DisplayType;
                const years = measure?.AvailableTimes.sort((a, b) => b.start_period - a.start_period);
                const geography = measure?.AvailableGeographyTypes;
                const links = measure?.VisOptions[0].Links && measure?.VisOptions[0]?.Links[0];
                const map = measure?.VisOptions[0].Map && measure?.VisOptions[0].Map[0]?.On;
                const trend = measure?.VisOptions[0].Trend && measure?.VisOptions[0].Trend[0]?.On;
                const trendDisparities = measure?.VisOptions[0].Trend && measure?.VisOptions[0].Trend[0]?.Disparities;
                const about = measure.how_calculated;
                const sources = measure.Sources;
                const measureId = measure.MeasureID;


                // ----- handle map measures ----- //
                
                if (map === 1) {
                    
                    mapMeasures.push(measure)

                    dropdownMapMeasures.innerHTML += `<div class="dropdown-column-${index}"><div class="dropdown-title"><strong> ${type}</strong></div></div>`;

                    const dropdownMapMeasuresColumn = document.querySelector(`.dropdown-column-${index}`);
                    
                    mapYears.map((time, index) => {
                        dropdownMapMeasuresColumn.innerHTML += `<button class="dropdown-item link-measure mapbutton"
                        data-measure-id="${measureId}"
                        data-time="${time}">
                        ${time}
                        </button>`;

                    });
                }
            

                // ----- handle trend measures ----- //

                if (trend === 1) {

                    trendMeasures.push(measure)

                    if (fullDataTrendObjects) {
                        dropdownTrendMeasures.innerHTML += `<button class="dropdown-item link-measure trendbutton"
                        data-measure-id="${measureId}"> 
                        ${type}
                        </button>`;
                    }
                }
                
                
                // ----- handle links measures ----- //
                
                if (links) {
                    
                    // create linked measures object

                    linksMeasures.push(measure)

                    // get secondary measure id
                    
                    const secondaryMeasureId = measure.VisOptions[0].Links[0].MeasureID;
                    

                    if (fullDataTableObjects) {
                        
                        const linkYears = [...new Set(fullDataTableObjects.map(item => item.Time))];

                        dropdownLinksMeasures.innerHTML += 
                            `<div class="dropdown-title"><strong> ${type}</strong></div>`;
                        
                        measure.VisOptions[0].Links.map(link => {

                            const linksSecondaryIndicator = indicators.filter(indicator =>
                                indicator.Measures.some(m => 
                                    m.MeasureID === link.MeasureID)
                            );
                            
                            const linksSecondaryMeasure = linksSecondaryIndicator[0].Measures.filter(m => 
                                m.MeasureID === link.MeasureID
                            );
                            
                            dropdownLinksMeasures.innerHTML += 
                                `<button class="dropdown-item link-measure linksbutton" 
                                data-primary-measure-id="${measureId}"
                                data-measure-id="${measure.MeasureID}"
                                data-secondary-measure-id="${link.MeasureID}">
                                ${linksSecondaryMeasure[0].MeasureName}
                            </button>`;
                            
                        });
                    }
                }
            });

            
            setDefaultMapMeasure(mapMeasures);
            
            setDefaultTrendMeasure(trendMeasures);
            
            // set default measure for links; also calls filterSecondaryIndicatorMeasure, which creates the joined data
            
            await setDefaultLinksMeasure(linksMeasures);

            
            // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - //
            // functions to show to tabs
            // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - //

            // ===== table ===== //
            
            // define function

            showTable = (e) => {

                // console.log("** showTable");

                // ----- handle tab selection ----- //

                // set hash to summary

                window.location.hash = '#display=summary';
                currentHash = 'display=summary'

                // reset aria attributes

                tabTable.setAttribute('aria-selected', true);
                tabMap.setAttribute('aria-selected', false);
                tabTrend.setAttribute('aria-selected', false);
                tabLinks.setAttribute('aria-selected', false);


                // ----- set measure info boxes ----- //

                renderTitleDescription(indicatorShortName, indicatorDesc);
                renderAboutSources(measureAbout, measureSources);


                // ----- render the table ----- //
                
                // console.log("renderTable [#tab-btn-table]");
                renderTable();

                updateChartPlotSize();

                $($.fn.dataTable.tables(false))
                    .DataTable()
                    .columns.adjust().draw();

            };
            

            // ===== map ===== //

            // define function

            showMap = (e) => {

                // console.log("** showMap");

                // ----- handle tab selection ----- //

                // set hash to map
                
                window.location.hash = '#display=map'
                currentHash = 'display=map'

                // reset aria attributes

                tabTable.setAttribute('aria-selected', false);
                tabMap.setAttribute('aria-selected', true);
                tabTrend.setAttribute('aria-selected', false);
                tabLinks.setAttribute('aria-selected', false);

                
                

                // ----- allow map to persist when changing tabs ----- //

                if (!selectedMapMeasure) {

                    // this is all inside the conditional, because if a user clicks on this tab again
                    //  after selecting a measure, we don't want to recompute everything. We'll use the 
                    //  values created by the update function

                    // ----- get metatadata for default measure ----- //

                    // get default measure id
                
                    const defaultMeasureId = defaultMapMetadata[0].MeasureID;

                    // extract metadata for info boxes

                    const about   = defaultMapMetadata[0]?.how_calculated;
                    const sources = defaultMapMetadata[0].Sources;
                    const measure = defaultMapMetadata[0].MeasurementType;


                    // ----- set measure info boxes ----- //

                    defaultMapAbout   = 
                        `<h6>${indicatorName} - ${measure}</h6>
                        <p>${about}</p>`;

                    defaultMapSources = 
                        `<h6>${indicatorName} - ${measure}</h6>
                        <p>${sources}</p>`;
                        
                    // render measure info boxes

                    renderAboutSources(defaultMapAbout, defaultMapSources);


                    // ----- create dataset ----- //

                    // filter map data using default measure

                    let mapMeasureData = fullDataMapObjects.filter(
                            obj => obj.MeasureID === defaultMeasureId
                        );

                    // get the latest end_period

                    let latest_end_period = Math.max(mapMeasureData[0].end_period);

                    let mapTimeData = mapMeasureData.filter(
                            obj => obj.end_period === latest_end_period
                        );

                    // get the highest GeoRank for this measure and end_period
                    
                    let maxGeoRank = Math.max(mapTimeData[0].GeoRank);

                    filteredMapData = mapTimeData.filter(
                            obj => obj.GeoRank === maxGeoRank
                        );
                    
                    
                    // ----- render the map ----- //
                    
                    renderMap(filteredMapData, defaultMapMetadata);

                    updateChartPlotSize();

                } else {

                    // if there was a map already, restore it

                    // ----- set measure info boxes ----- //

                    renderAboutSources(selectedMapAbout, selectedMapSources);

                    // ----- render the map ----- //
                    
                    renderMap(filteredMapData, defaultMapMetadata);

                    updateChartPlotSize();
                }

            };


            // ===== trend ===== //

            // define function

            showTrend = (e) => {
            
                // console.log("** showTrend");

                // ----- handle tab selection ----- //

                // set hash to trend
                
                window.location.hash = '#display=trend'
                currentHash = 'display=trend'

                // reset aria attributes

                tabTable.setAttribute('aria-selected', false);
                tabMap.setAttribute('aria-selected', false);
                tabTrend.setAttribute('aria-selected', true);
                tabLinks.setAttribute('aria-selected', false);

                // what's this doing?

                
                

                // ----- allow chart to persist when changing tabs ----- //

                if (!selectedTrendMeasure) {

                    // this is all inside the conditional, because if a user clicks on this tab again
                    //  after selecting a measure, we don't want to recompute everything. We'll use the 
                    //  values created by the update function                


                    // ----- get metatadata for default measure ----- //

                    const about   = defaultTrendMetadata[0]?.how_calculated;
                    const sources = defaultTrendMetadata[0].Sources;
                    const measure = defaultTrendMetadata[0].MeasurementType;


                    // ----- set measure info boxes ----- //

                    defaultTrendAbout = 
                        `<h6>${indicatorName} - ${measure}</h6>
                        <p>${about}</p>`;

                    defaultTrendSources = 
                        `<h6>${indicatorName} - ${measure}</h6>
                        <p>${sources}</p>`;

                    renderAboutSources(defaultTrendAbout, defaultTrendSources);


                    // ----- handle disparities button ----- //

                    // switch on/off the disparities button
                    
                    const disparities = 
                        defaultTrendMetadata[0].VisOptions[0].Trend && 
                        defaultTrendMetadata[0].VisOptions[0].Trend[0]?.Disparities;

                    // hide or show disparities button

                    if (disparities == 0) {
                        
                        // if disparities is disabled, hide the button

                        btnShowDisparities.style.display = "none";

                        // remove click listener to button that calls renderDisparities

                        btnShowDisparities.removeEventListener("click", () => renderDisparities(defaultTrendMetadata, 221));
                        
                    } else if (disparities == 1) {
                        
                        // if disparities is enabled, show the button

                        btnShowDisparities.style.display = "inline";

                        // add click listener to button that calls renderDisparities

                        btnShowDisparities.addEventListener("click", () => renderDisparities(defaultTrendMetadata, 221));
                        
                    }


                    // ----- create dataset ----- //

                    const measureId = defaultTrendMetadata[0].MeasureID;
                    filteredTrendData = fullDataTrendObjects.filter(m => m.MeasureID === measureId);
                

                    // ----- render the chart ----- //

                    renderTrendChart(filteredTrendData, defaultTrendMetadata);

                    updateChartPlotSize();

                } else {

                    // if there was a chart already, restore it

                    // ----- set measure info boxes ----- //

                    renderAboutSources(selectedTrendAbout, selectedTrendSources);

                    // ----- render the chart ----- //

                    renderTrendChart(filteredTrendData, defaultTrendMetadata);

                    updateChartPlotSize();
                }

            };
            
            
            // ===== links ===== //
            
            // define function
            
            showLinks = (e) => {
                
                // console.log("** showLinks");

                // ----- handle tab selection ----- //

                // set hash to links
                
                window.location.hash = '#display=links'
                currentHash = 'display=links'
                // console.log("currentHash [showLinks]", currentHash);

                // reset aria attributes

                tabTable.setAttribute('aria-selected', false);
                tabMap.setAttribute('aria-selected', false);
                tabTrend.setAttribute('aria-selected', false);
                tabLinks.setAttribute('aria-selected', true);
                

                // ----- allow chart to persist when changing tabs ----- //

                // console.log("selectedLinksMeasure", selectedLinksMeasure);

                if (!selectedLinksMeasure) {

                    // this is all inside the conditional, because if a user clicks on this tab again
                    //  after selecting a measure, we don't want to recompute everything. We'll use the 
                    //  values created by the update function
                    
                    // ----- get metatadata for default measure ----- //

                    // get first linked measure by default
                    
                    const secondaryMeasureId = defaultLinksMetadata[0]?.VisOptions[0].Links[0].MeasureID;
                    
                    // get linked indicator's metadata

                    const linksSecondaryIndicator = indicators.filter(indicator =>
                        indicator.Measures.some(measure => 
                            measure.MeasureID === secondaryMeasureId
                        )
                    )
                    
                    // use linked indicator's metadata to get linked measure's metadata

                    const linksSecondaryMeasure = linksSecondaryIndicator[0].Measures.filter(m =>
                        m.MeasureID === secondaryMeasureId
                    )

                    primaryIndicatorName   = indicatorName;
                    secondaryIndicatorName = linksSecondaryIndicator[0].IndicatorName;
                    
                    // get measure metadata

                    const primaryMeasure         = defaultLinksMetadata[0].MeasurementType;
                    const primaryAbout           = defaultLinksMetadata[0].how_calculated;
                    const primarySources         = defaultLinksMetadata[0].Sources;
                    
                    const secondaryMeasure       = linksSecondaryMeasure[0].MeasurementType;
                    const secondaryAbout         = linksSecondaryMeasure[0].how_calculated;
                    const secondarySources       = linksSecondaryMeasure[0].Sources;


                    // ----- set measure info boxes ----- //

                    // creating indicator & measure info
                    
                    defaultLinksAbout = 
                        `<h6>${primaryIndicatorName} - ${primaryMeasure}</h6>
                        <p>${primaryAbout}</p>
                        <h6>${secondaryIndicatorName} - ${secondaryMeasure}</h6>
                        <p>${secondaryAbout}</p>`;

                    defaultLinksSources = 
                        `<h6>${primaryIndicatorName} - ${primaryMeasure}</h6>
                        <p>${primarySources}</p>
                        <h6>${secondaryIndicatorName} - ${secondaryMeasure}</h6>
                        <p>${secondarySources}</p>`;

                    
                    // ----- create dataset ----- //

                    // use joinedDataLinksObjects (created in filterSecondaryIndicatorMeasure) to get the 
                    //  highest GeoRank, then keep just that geo
                    
                    // let maxGeoRank = Math.max(joinedDataLinksObjects[0].GeoRank);
                    // filteredLinksData = joinedDataLinksObjects.filter(obj => obj.GeoRank === maxGeoRank)

                    renderAboutSources(defaultLinksAbout, defaultLinksSources);


                    // ----- render the chart ----- //

                    // joined data and metadata created in filterSecondaryIndicatorMeasure called fron setDefaultLinksMeasure

                    renderLinksChart(
                        joinedDataLinksObjects,
                        primaryMeasureMetadata,
                        secondaryMeasureMetadata,
                        primaryIndicatorName,
                        secondaryIndicatorName
                    );

                    updateChartPlotSize();

                } else {

                    // if there was a chart already, restore it

                    // ----- set measure info boxes ----- //

                    renderAboutSources(selectedLinksAbout, selectedLinksSources);

                    // ----- render the chart ----- //

                    renderLinksChart(
                        joinedDataLinksObjects,
                        primaryMeasureMetadata,
                        secondaryMeasureMetadata,
                        primaryIndicatorName,
                        secondaryIndicatorName
                    );

                    updateChartPlotSize();
                }
                
            };


            // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - //
            // disable tabs and switch to summary if there are no measures
            // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - //

            // this is effectively the state of the tabs when the indicator is loaded or changed
            
            const tabTableSelected = tabTable.getAttribute('aria-selected');
            const tabMapSelected   = tabMap.getAttribute('aria-selected');
            const tabTrendSelected = tabTrend.getAttribute('aria-selected');
            const tabLinksSelected = tabLinks.getAttribute('aria-selected');

            // console.log("tabTableSelected:", tabTableSelected, "| tabMapSelected:", tabMapSelected, "| tabTrendSelected:", tabTrendSelected, "| tabLinksSelected:", tabLinksSelected);
            
            const disableTab = (el) => {
                el.classList.add('disabled');
                el.setAttribute('aria-disabled', true);
            }
            
            const enableTab = (el) => {
                el.classList.remove('disabled');
                el.setAttribute('aria-disabled', false);
            }
            

            // if there's no data to display for a tab, disable it. If you're on that tab when you switch to 
            //  a new indicator (which calls renderMeasures), then switch to the summary table

            if (mapMeasures.length === 0) {
                
                // console.log("disable map");
                // console.log("map hash", window.location.hash);
                // console.log("> map switch", tabMapSelected && window.location.hash === '#display=map');

                if (tabMapSelected && window.location.hash === '#display=map') {
                    
                    // console.log("switch to table");
                    
                    $('#tab-btn-table').tab('show');
                    showTable();
                    
                }

                disableTab(tabMap);
                
            } else {
                
                enableTab(tabMap);
            }


            const onlyOneTime = trendMeasures.every(m => m.AvailableTimes.length <= 1)
            // console.log("onlyOneTime", onlyOneTime);

            if (trendMeasures.length === 0 || onlyOneTime) {
                
                // console.log("disable trend");
                // console.log("trend hash", window.location.hash);

                if (tabTrendSelected && window.location.hash === '#display=trend') {
                    
                    // console.log("switch to table");
                    
                    $('#tab-btn-table').tab('show');
                    showTable();

                    $($.fn.dataTable.tables(true))
                        .DataTable()
                        .columns.adjust().draw();
                    
                }
                
                disableTab(tabTrend);
                
            } else {
                
                enableTab(tabTrend);
            }

            if (linksMeasures.length === 0) {
                
                // console.log("disable links");
                // console.log("links hash", window.location.hash);
                // console.log("> links switch", tabLinksSelected && window.location.hash === '#display=links');

                if (tabLinksSelected && window.location.hash === '#display=links') {
                    
                    // console.log("switch to table");

                    $('#tab-btn-table').tab('show');
                    showTable();
                    
                }

                disableTab(tabLinks);

            } else {
                
                enableTab(tabLinks);
            }


            // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - //
            // set tab based on hash
            // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - //

            let hash = window.location.hash.replace('#', "")

            switch (hash) {

                // using fallthrough

                case 'display=summary':
                case 'tab-table':
                    // console.log("~ switch ~ summary");
                    // showTable();
                    $('#tab-btn-table').tab('show');
                    window.dispatchEvent(hashchange);
                    break;

                case 'display=map':
                case 'tab-map':
                    // console.log("~ switch ~ map");
                    // showMap();
                    $('#tab-btn-map').tab('show');
                    window.dispatchEvent(hashchange);
                    break;

                case 'display=trend':
                case 'tab-trend':
                    // console.log("~ switch ~ trend");
                    // showTrend();
                    $('#tab-btn-trend').tab('show');
                    window.dispatchEvent(hashchange);
                    break;

                case 'display=links':
                case 'tab-links':
                    // console.log("~ switch ~ links");
                    // showLinks();
                    $('#tab-btn-links').tab('show');
                    window.dispatchEvent(hashchange);
                    break;
                    
                default:
                    // console.log("~ switch ~ default");
                    // showTable();
                    window.location.hash = 'display=summary';
                    $('#tab-btn-table').tab('show');
            }
            

            // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - //
            // add event listeners to measure dropdown elements, will call the 
            //  respective update functions
            // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - //

            // without custom class, selector would be '[aria-labelledby="dropdownMapMeasures"] button.link-measure'

            let mapMeasuresLinks = document.querySelectorAll('.mapbutton');
            let trendMeasuresLinks = document.querySelectorAll('.trendbutton');
            let linksMeasuresLinks = document.querySelectorAll('.linksbutton');

            // adding click listeners using update functions
            // https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener#memory_issues
            
            mapMeasuresLinks.forEach(link => {
                link.addEventListener('click', updateMapData);
            })

            trendMeasuresLinks.forEach(link => {
                link.addEventListener('click', updateTrendData);
            })

            linksMeasuresLinks.forEach(link => {
                link.addEventListener('click', updateLinksData);
            })
            
            
            // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - //
            // add event handler functions to summary tab checkboxes
            // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - //
            
            const checkboxYear = document.querySelectorAll('.checkbox-year');
            const checkboxGeo = document.querySelectorAll('.checkbox-geo');
            
            checkboxYear.forEach(checkbox => {
                handleYearFilter(checkbox, indicatorId);
            })
            checkboxGeo.forEach(checkbox => {
                handleGeoFilter(checkbox, indicatorId);
            })
            
            
            // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - //
            // Render default Measure About and Sources
            // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - //
            
            measureAbout = '';
            measureSources = '';
            indicatorMeasures.map(measure => {

                measureAbout += 
                    `<h6>${measure.MeasurementType}</h6>
                    <p>${measure.how_calculated}</p>`;

                measureSources += 
                    `<h6>${measure.MeasurementType}</h6>
                    <p>${measure.Sources}</p>`;

            })
            
            renderAboutSources(measureAbout, measureSources);

        }


    // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - //
    // add listeners to tabs
    // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - //

    // ===== table ===== /

    $('#tab-btn-table').on('click', e => {
        
        $(e.currentTarget).tab('show');
        window.location.hash = 'display=summary'
        
    })

    // ===== map ===== /

    $('#tab-btn-map').on('click', e => {
        
        $(e.currentTarget).tab('show');
        window.location.hash = 'display=map'
        
    })   
    
    // ===== trend ===== /
    
    $('#tab-btn-trend').on('click', e => {
        
        $(e.currentTarget).tab('show');
        window.location.hash = 'display=trend'
        
    })  
    
    // ===== links ===== /

    $('#tab-btn-links').on('click', e => {
        
        $(e.currentTarget).tab('show');
        window.location.hash = 'display=links'
        
    })   

    </script>



</article>



<script type="text/javascript" src="https://nychealth.github.io/EH-dataportal/js/accessible-autocomplete.min.js" integrity=""></script>

<script type="text/javascript"> 
    
    function createCitation() {
        
        let today = new Date();
        let dd = String(today.getDate()).padStart(2, '0');
        let mm = String(today.getMonth() + 1).padStart(2, '0'); 
        let yyyy = today.getFullYear();
        today = mm + '/' + dd + '/' + yyyy;
        
        
        let citation = "New York City Department of Health, Environment & Health Data Portal. "  + `"Worker health"` + " data. " + indicatorName + '. Accessed at ' + `"https://nychealth.github.io/EH-dataportal/data-explorer/worker-health/"` + ' on ' + today + "."
        
        
        document.getElementById('citeText').setAttribute('value',citation);
        
        
        
        let btn = document.getElementById('citeButton')
        btn.innerHTML = `<i class="fas fa-copy mr-1"></i>Copy citation`
        
    }
    
    function copyCitation(){
        let citeText = document.getElementById('citeText')
        citeText.select()
        citeText.setSelectionRange(0,99999);
        navigator.clipboard.writeText(citeText.value)
        let btn = document.getElementById('citeButton')
        btn.innerHTML = `<i class="fas fa-copy mr-1"></i>Copied!`
        
    }
    
    createCitation();
    
    let downloadTable;
    let dataURL; 
    let downloadTableCSV
    let csvData
    
    
    function runDataDownload() {
        
        dataURL = data_branch + "/" + data_repo + '/indicators/data/' + indicatorId + '.json'
        
        aq.loadJSON(`${dataURL}`).then(function(data) {
            downloadTable = data;
            downloadTableCSV = downloadTable.toCSV()
            
            csvData = 'data:application/csv;charset=utf-8,' + encodeURIComponent(downloadTableCSV);
            let hiddenElement = document.createElement('a');  
            hiddenElement.href = csvData;
            hiddenElement.target = '_blank';  
            hiddenElement.download = 'NYC EH Data Portal: ' + indicatorName + '.csv'
            hiddenElement.click();
        })
    }
    
</script>

<ul id="results"></ul>
  </main>
  
  <div class="modal" tabindex="-1" role="dialog" id="prototypeModal">
    <div class='modal-dialog modal-lg modal-dialog-centered' role='document'>
        <div class='modal-content'>
            <div class='modal-header'>
                <h5 class='modal-title'>Welcome to the Prototype EH Data website. </h5>
            </div>
            <div class='modal-body'>
                <p>This prototype is a work in progress. That means that not all of the data or information is final.
                    But, feel free to click around and explore.
                </p>
                <p><strong>Please sign up for our email list</strong>. We will email you every few months with updates,
                    or opportunities to participate in user research. 
                    <a href='https://docs.google.com/forms/d/e/1FAIpQLSfUg3JE5ODNc6aqBPJwM8mZ80TYtK6ISw-OM7PBwKuoN3M--g/viewform'>Click here to sign up</a>.
                </p>
            </div>
            <hr>
            <button type="button" class="btn btn-outline-primary close-dialog" data-dismiss="modal">Close</button>
        </div>
    </div>
</div>

<script src="../../js/conditional-modal.js"></script>
<footer class="bg-black" id="global-footer" role="contentinfo">

  <h2 class="sr-only">
      Page Footer
  </h2>

  <div class="bg-opacity-black-25 text-white" id="nyc-footer">

      <div class="container py-3 d-none" id="languages">

          <div class="row fs-md">

              <div class="col-6 col-md-4 col-lg mb-2 mb-lg-0">
                  <ul class="extensible-list">
                      <li><a class="lang-select text-reset" href="#" data-lang="ar">عربى</a></li>
                      <li><a class="lang-select text-reset" href="#" data-lang="bn">বাঙালি</a></li>
                  </ul>
              </div>
              <div class="col-6 col-md-4 col-lg mb-2 mb-lg-0">
                  <ul class="extensible-list">
                      <li><a class="lang-select text-reset" href="#" data-lang="zh-CN">中文</a></li>
                      <li><a class="lang-select text-reset" href="#" data-lang="fr">français</a></li>
                  </ul>
              </div>
              <div class="col-6 col-md-4 col-lg mb-2 mb-lg-0">
                  <ul class="extensible-list">
                      <li><a class="lang-select text-reset" href="#" data-lang="ht">Kreyòl Ayisyen</a></li>
                      <li><a class="lang-select text-reset" href="#" data-lang="ko">한국어</a></li>
                  </ul>
              </div>
              <div class="col-6 col-md-4 col-lg mb-2 mb-lg-0">
                  <ul class="extensible-list">
                      <li><a class="lang-select text-reset" href="#" data-lang="pl">Polskie</a></li>
                      <li><a class="lang-select text-reset" href="#" data-lang="ru">русский</a></li>
                  </ul>
              </div>
              <div class="col-6 col-md-4 col-lg">
                  <ul class="extensible-list">
                      <li><a class="lang-select text-reset" href="#" data-lang="es">Español</a></li>
                      <li><a class="lang-select text-reset" href="#" data-lang="ur">اردو</a></li>
                  </ul>
              </div>
          </div>

      </div>
      

      <div class="container py-3" id="languages">

          <ul class="fs-md" role="list">
              <li><a class="lang-select text-reset" href="#" data-lang="ar">عربى</a></li>
              <li><a class="lang-select text-reset" href="#" data-lang="bn">বাঙালি</a></li>
              <li><a class="lang-select text-reset" href="#" data-lang="zh-CN">中文</a></li>
              <li><a class="lang-select text-reset" href="#" data-lang="fr">français</a></li>
              <li><a class="lang-select text-reset" href="#" data-lang="ht">Kreyòl Ayisyen</a></li>
              <li><a class="lang-select text-reset" href="#" data-lang="ko">한국어</a></li>
              <li><a class="lang-select text-reset" href="#" data-lang="pl">Polskie</a></li>
              <li><a class="lang-select text-reset" href="#" data-lang="ru">русский</a></li>
              <li><a class="lang-select text-reset" href="#" data-lang="es">Español</a></li>
              <li><a class="lang-select text-reset" href="#" data-lang="ur">اردو</a></li>
          </ul>

      </div>
      

      <hr class="opacity-10" aria-hidden="true">

      <div class="container py-3">
          <div class="row">
              <div class="col-md-6 col-lg-8 mb-3 mb-lg-0">
                  <nav class="row fs-md" role="navigation">
                      <div class="col-lg mb-3 mb-lg-0">
                          <ul class="extensible-list">
                              <li>
                                  <a class="text-reset" href="https://www1.nyc.gov/nyc-resources/agencies.page">
                                      <strong>City Agencies</strong>
                                  </a>
                              </li>
                              <li>
                                  <a class="text-reset" href="https://a858-nycnotify.nyc.gov/notifynyc/">
                                      <strong>Notify NYC</strong>
                                  </a>
                              </li>
                              <li>
                                  <a class="text-reset"
                                      href="https://www1.nyc.gov/connect/mobile-applications.page">
                                      <strong>NYC Mobile Apps</strong>
                                  </a>
                              </li>
                          </ul>
                      </div>
                      

                      <div class="col-lg mb-3 mb-lg-0">

                          <ul class="extensible-list">
                              <li>
                                  <a class="text-reset" href="https://www1.nyc.gov/home/contact-us.page">
                                      <strong>Contact NYC Government</strong>
                                  </a>
                              </li>
                              <li>
                                  <a class="text-reset" href="https://a856-citystore.nyc.gov/">
                                      <strong>CityStore</strong>
                                  </a>
                              </li>
                              <li>
                                  <a class="text-reset" href="https://maps.nyc.gov/doitt/nycitymap/">
                                      <strong>Maps</strong>
                                  </a>
                              </li>
                          </ul>

                      </div>
                      

                      <div class="col-lg mb-3 mb-lg-0">

                          <ul class="extensible-list">
                              <li>
                                  <a class="text-reset"
                                      href="https://a127-ess.nyc.gov/psp/prdess/?cmd=login&languageCd=ENG&">
                                      <strong>City Employees</strong>
                                  </a>
                              </li>
                              <li>
                                  <a class="text-reset" href="https://www1.nyc.gov/connect/social-media.page">
                                      <strong>Stay Connected</strong>
                                  </a>
                              </li>
                              <li>
                                  <a class="text-reset"
                                      href="https://www1.nyc.gov/nyc-resources/resident-toolkit.page">
                                      <strong>Resident Toolkit</strong>
                                  </a>
                              </li>
                          </ul>
                      </div>
                      

                  </nav>
              </div>
              

              <div class="col-md-6 col-lg-4">

                  <a class="mb-2" href="https://www1.nyc.gov" title="Go to nyc.gov" target="_blank">
                      
                      <img class="mb-2" src="https://nychealth.github.io/EH-dataportal/images/nyc-bubble-logo.svg" width="90" alt="NYC Logo">
                      <span class="sr-only">(opens in a new tab)</span>
                  </a>
                  <p class="fs-sm">City of New York - 2019 All Rights Reserved. NYC is a trademark and service
                      mark of the City of New York.</p>

                  <ul class="extensible-list horizontal fs-sm">
                      <li>
                          <a class="text-reset" href="https://www1.nyc.gov/home/privacy-policy.page">Privacy
                              Policy</a>
                      </li>
                      <li>
                          <a class="text-reset" href="https://www1.nyc.gov/home/terms-of-use.page">Terms
                              of Use</a>
                      </li>
                      <li>
                          <a class="text-reset" href="https://www1.nyc.gov/site/mopd/index.page"
                              title="Mayor's Office for People with Disabilities">
                              <span class="sr-only">Mayor's Office for People with Disabilities</span>
                              <span class="fab fa-lg fa-accessible-icon"></span>
                          </a>
                      </li>
                  </ul>

              </div>
              

          </div>
          

      </div>
      

  </div>
  

</footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
    integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
    crossorigin="anonymous"></script>

<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
    integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
    crossorigin="anonymous"></script>


<script>
  function googleTranslateElementInit() {
      new google.translate.TranslateElement({
          pageLanguage: 'en'
      }, 'google_translate_element');
  }
</script>

<script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
<script src="https://unpkg.com/lunr/lunr.js"></script>
<script src="https://unpkg.com/lunr/lunr.js"></script>
<script type="text/javascript" src="https://nychealth.github.io/EH-dataportal/js/search.js" integrity=""></script></body>
</html>
