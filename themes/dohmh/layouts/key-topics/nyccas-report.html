{{- define "main" -}}

<style type="text/css">hr {
    margin-top: 25px;
    margin-bottom: 25px;
   }

   .greenleftborder {
    border-left: 8px solid #00923E50;
    padding-left: 10px;
}
</style>

<div class="container-fluid px-0">
    <div class="row no-gutters px-0">
        {{ $src := .Resources.GetMatch .Params.image }}
        {{ $image := $src.Resize "1920x"}}
        <div id="datastoryheader" style="background-image: URL({{ $image.RelPermalink }}); background-position: 50% 25%">
    
            <div class="medium my-auto">
                <h1 class="titleheader py-2 px-4" data-pagefind-weight="10.0">
                    {{ .Title }}
                </h1>
            </div>
        </div>
    </div>
</div>

<article class="container-fluid" id="skip-header-target">

    <div class="row">
        <div class="col-md-11 mx-auto mt-4 pl-0">
            <nav aria-label="breadcrumb" class="mb-4">
                <ul class="breadcrumb">
                    <li class="breadcrumb-item"><a href={{ relURL "" }}>Home</a></li>
                    <li class="breadcrumb-item"><a href={{ relURL "key-topics" }}>Key Topics</a></li>
                    <li class="breadcrumb-item"><a href="..">
                        {{- with .Parent -}} {{ .Title }} </a></li>{{- end -}}
                    <li class="breadcrumb-item active" aria-current="page">{{ .Title }}</li>
                </ul>
            </nav>
        </div>
        <div class="col-md-2 mr-auto"></div>
    </div>

    <div class="row" data-pagefind-weight="7.0">
        <div class="col-md-8 col-sm-12 mx-auto">
            <!-- Introduction and Key Findings -->
            <div class="medium mb-2">        
                {{- .Content  -}}
            </div>
    </div>


            <!-- Pollutants and Methods -->

    <div class="row">
        <div class="col-md-10 col-sm-12 mx-auto" data-pagefind-weight="7.0">
            <hr class="my-2">
            <div class="row">
                <div class="col-sm-6 col-xs-12">
                    <div class="greenleftborder">
                        <h3>Methods</h3>
                        <p>The Health Department designed NYCCAS to understand how average air pollution levels vary from place to place within New York City. NYCCAS staff mount samplers on street light poles 10 to 12 feet off the ground along residential and commercial streets and in parks. The monitors use a small battery-powered pump and filters to collect air samples. Our air samplers are deployed at each NYCCAS site once each season and collect data for a two-week period. Samples are collected in all seasons for NO, NO<sub>2</sub>, PM<sub>2.5</sub> and BC; in the summer for O<sub>3</sub>; and in the winter for SO<sub>2</sub>. For more details on sample collection methods, see <a href="Appendix1.pdf">Appendix 1 (PDF)</a>.</p>
                        <p>The New York State Department of Environmental Conservation also has a network of 19 air quality monitors in New York City that are required by the Federal government, but they are mounted on building roofs. We placed our air samplers at street level to measure pollution where people spend time, and where traffic-related pollution levels are usually higher.</p>
                        <p>NYCCAS has also deployed a limited number of monitors that can measure PM<sub>2.5</sub> levels in real time. These monitors allow us to monitor air pollution as it changes based on the time of day, weather or due to local pollution sources, such as heavy-duty trucks. The data from these monitors is available here: <a href="../realtime/">Real-Time Air Quality</a>.</p>

                    </div>
                </div>

                <div class="col-sm-6 col-xs-12">
                    <h3>Pollutants Measured</h3>

                    

                    <div class="accordion-group mt-2 mb-3" role="tablist" id="accordion-01">
                        <div class="card accordion-item border">
                            <a class="card-header font-weight-bold collapse" id="acc-button-01" data-toggle="collapse" href="#panel-acc-button-01" role="tab" aria-expanded="false" aria-controls="panel-acc-button-01">
                                <span class="title" role="heading" aria-level="3">Fine Particles</span>
                            </a>
                            <div class="collapse show" id="panel-acc-button-01" role="tabpanel" aria-labelledby="acc-button-01" data-parent="#accordion-01">
                                <div class="card-body bg-white text-black">
                                    <p>
                                        Fine particles (PM<sub>2.5</sub>) are tiny airborne solid and liquid particles less than 2.5 microns in diameter. PM<sub>2.5</sub> is the most harmful urban air pollutant. It is small enough to penetrate deep into the lungs and enter the bloodstream, which can worsen lung and heart disease and lead to hospital admissions and premature deaths. PM<sub>2.5</sub> can either be directly emitted or formed in the atmosphere from other pollutants. Fuel combustion in vehicles, boilers in buildings, power plants, construction equipment, marine vessels and commercial cooking are all common sources of PM<sub>2.5</sub>. Between 20% and 30% of the PM<sub>2.5</sub> in New York City's air comes from sources in areas upwind from the city, such as coal-burning power plants in the Midwest.
                                    </p>
                                </div>
                            </div>
                        </div>

                        <div class="card accordion-item border">
                            <a class="card-header font-weight-bold collapse collapsed" id="acc-button-02" data-toggle="collapse" href="#panel-acc-button-02" role="tab" aria-expanded="false" aria-controls="panel-acc-button-02">
                                <span class="title" role="heading" aria-level="3">Black Carbon</span>
                            </a>
                            <div class="collapse" id="panel-acc-button-02" role="tabpanel" aria-labelledby="acc-button-02" data-parent="#accordion-01">
                                <div class="card-body bg-white text-black">
                                    <p>
                                        Black carbon (BC) is one type of PM<sub>2.5</sub> and is the sooty black material emitted from gas and diesel engines, coal-fired power plants and other sources that burn fossil fuels. It comprises up to 20% of fine particulate matter in New York City. Unlike other fine particles, BC is primarily from local sources. Inhalation of BC is associated with health problems, including respiratory and cardiovascular disease, cancer and birth defects. BC also contributes to climate change by altering the patterns of rain and clouds.
                                    </p>
                                </div>
                            </div>
                        </div>

                        <div class="card accordion-item border">
                            <a class="card-header font-weight-bold collapse collapsed" id="acc-button-03" data-toggle="collapse" href="#panel-acc-button-03" role="tab" aria-expanded="false" aria-controls="panel-acc-button-03">
                                <span class="title" role="heading" aria-level="3">Nitrogen Dioxide and Nitric Oxide</span>
                            </a>
                            <div class="collapse" id="panel-acc-button-03" role="tabpanel" aria-labelledby="acc-button-03" data-parent="#accordion-01">
                                <div class="card-body bg-white text-black">
                                    <p>
                                        Nitrogen dioxide (NO<sub>2</sub>) and nitric oxide (NO) are part of a group of pollutants called "oxides of nitrogen" (NO<sub>X</sub>). Exposures to NO<sub>X</sub> are linked to increased emergency department visits and hospitalizations for respiratory conditions, particularly asthma. NO<sub>X</sub> also reacts with other compounds in the atmosphere to form PM<sub>2.5</sub> and ozone. A variety of combustion sources produce NO<sub>X</sub> in New York City, including motor vehicles, buildings, marine vessels and construction equipment.
                                    </p>
                                </div>
                            </div>
                        </div>

                        <div class="card accordion-item border">
                            <a class="card-header font-weight-bold collapse collapsed" id="acc-button-04" data-toggle="collapse" href="#panel-acc-button-04" role="tab" aria-expanded="false" aria-controls="panel-acc-button-04">
                                <span class="title" role="heading" aria-level="3">Ozone</span>
                            </a>
                            <div class="collapse" id="panel-acc-button-04" role="tabpanel" aria-labelledby="acc-button-04" data-parent="#accordion-01">
                                <div class="card-body bg-white text-black">
                                    <p>
                                        Ozone (O<sub>3</sub>) forms at ground level when NO<sub>X</sub> emissions combine with sunlight and other airborne pollutants. Measured O<sub>3</sub> concentrations are often highest in the summer and downwind from areas with high NO<sub>X</sub> emissions, such as places with high traffic density. In areas with heavy traffic, NO<sub>X</sub> reacts with any ground-level O<sub>3</sub> to reduce O<sub>3</sub> concentrations. As a result, NYCCAS has measured lower O<sub>3</sub> levels near roadways, in city centers and in other areas of high NO<sub>X</sub> emissions density. Higher levels of O<sub>3</sub> are seen in areas away from dense traffic and building emissions.
                                    </p>
                                </div>
                            </div>
                        </div>

                        <div class="card accordion-item border">
                            <a class="card-header font-weight-bold collapse collapsed" id="acc-button-05" data-toggle="collapse" href="#panel-acc-button-05" role="tab" aria-expanded="false" aria-controls="panel-acc-button-05">
                                <span class="title" role="heading" aria-level="3">Sulfur Dioxide</span>
                            </a>
                            <div class="collapse" id="panel-acc-button-05" role="tabpanel" aria-labelledby="acc-button-05" data-parent="#accordion-01">
                                <div class="card-body bg-white text-black">
                                    <p>
                                        Sulfur dioxide (SO<sub>2</sub>) is produced mainly by burning oils with high sulfur content, such as No. 4 and No. 6 oil (also known as residual fuel oil), or high-sulfur No. 2 oil. The primary use of fuel oil in NYC is to heat buildings and water, which is why we only monitor it in the winter. Some high-sulfur oil is also used to generate electricity and power marine vessels. SO<sub>2</sub> exposures can worsen lung diseases, causing hospitalizations and emergency department visits for asthma and other respiratory conditions. SO<sub>2</sub> also contributes to the formation of PM<sub>2.5</sub> in the atmosphere, resulting in PM<sub>2.5</sub> exposures downwind of SO<sub>2</sub> emissions.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <hr class="my-2">

            <div class="row">
                <div class="col-sm-6 col-cx-12">
                    <div class="greenleftborder">
                        <h3>NYCCAS Sites</h3>
                        <p>The monitoring locations represent a wide variety of New York City environments â€“ sidewalks, busy streets, parks and quiet neighborhood roads. Most of the sites (80%) were chosen by the Health Department to ensure representation in all types of neighborhoods, including residential, commercial and industrial areas. The locations vary in how many trees they have and in the density of traffic and buildings. The remaining sites were selected because they are near potentially high-emission locations that were not captured in the initial assignment. These include Times Square, the Port Authority Bus Terminal and the entrance to the Holland Tunnel. The number of sites has changed over the years as we have learned about air quality in our city. In 2021, we monitored 78 routine locations and an additional 15 sites in low-income neighborhoods that would benefit from additional monitoring to understand potential sources of emissions. We refer to these as <a href="../../../data-stories/aqsnapshots">Environmental Justice Sites</a>, in <span style="font-weight:bold; color:green">green</span> on the map.</p>

                    </div>
                </div>
                <div class="col-sm-6 col-cx-12">
                    <iframe src="embed/nyccas-sites-leaflet.html" frameborder="no" style="width: 100%; height: 550px"></iframe>
                </div>

            </div>

            <hr class="my-2">



        </div>
    </div>

    <div class="row">
        <div class="col-md-8 col-sm-12 mx-auto">
            <!-- Pollutant maps: text to FMV, maps to template -->
            <h2>Pollutant Maps</h2>
            {{ .Params.pollutantMaps | safeHTML }}


            <div id="pollutantMaps">
                <hr>
                <div class="row">

                    <div class="col">
                        <button type="button" class="btn btn-outline yearbtn" id="btn1" disabled>2021:</button>
                        <button type="button" class="btn polbtn btn-outline-dark active" value="bc">BC</button>
                        <button type="button" class="btn polbtn btn-outline-dark" value="no">NO</button>
                        <button type="button" class="btn polbtn btn-outline-dark" value="no2">NO<sub>2</sub></button>
                        <button type="button" class="btn polbtn  btn-outline-dark" value="o3">O<sub>3</sub></button>
                        <button type="button" class="btn polbtn btn-outline-dark" value="pm25">PM<sub>2.5</sub></button>
                        <button type="button" class="btn btn-outline-dark mb-2 float-right" id="btn2" data-toggle="modal" data-target="#mapModal">All years</button>
                    </div>
                </div>

                <div class="row" style="height: 550px;">
                    <div class="col-sm-7">
                        <iframe id="iframeEmbed" src="raster/bc_2021.html" style="width:100%;height:100%;" frameborder="off"></iframe>
                    </div>

                    <div class="col-sm-5" id="mapText">
                        <div id="bcText" class="polText">
                            <p>Citywide, annual average levels of Black Carbon declined by 45% between 2009 and 2021, an average of 0.05 micrograms per cubic meter per year.
                            </p>
                            <p>Across the 13-year period, higher levels were consistently seen near warehouses within industrial areas (reflecting increased truck traffic density) and in areas with higher nearby commercial cooking grills/charbroilers.
                            </p>
                            <p>In 2021, seasonal average BC concentrations across NYCCAS monitoring sites ranged from 0.23 to 1.9 micrograms per cubic meter.
                            </p>
                        </div>

                        <div id="noText" class="polText hide">
                            <p>Citywide, annual average levels of Nitric Oxide declined by 58% between 2009 and 2021, an average of 1.7 parts per billion per year.
                            </p>
                            <p>Across the 13-year period, higher levels were consistently seen at sites with higher nearby building density, emissions from overall traffic and from truck traffic related to warehouses. 
                            </p>
                            <p>In 2021, seasonal average NO concentrations across NYCCAS monitoring sites ranged from 2.6 to 59.9 ppb.
                            </p>
                        </div>

                        <div id="no2Text" class="polText hide">
                            <p>Citywide, annual average levels of Nitrogen Dioxide declined by 38% between 2009 and 2021, an average of 0.86 parts per billion per year.
                            </p>
                            <p>Across the 13-year period, higher levels were consistently seen at sites with higher nearby building and traffic emissions.  The persistence of building density as the most important indicator of NO<sub>2</sub> reflects the continued use of fossil fuel combustion for heat and hot water, even as fuels become cleaner and equipment more efficient.  
                            </p>
                            <p>In 2021, seasonal average NO<sub>2</sub> concentrations across NYCCAS monitoring sites ranged from 3.7 to 37.1 ppb.
                            </p>
                        </div>

                        <div id="o3Text" class="polText hide">
                            <p>Since the first summer (2009) when relatively cool temperatures contributed to lower levels of Ozone, citywide summertime average levels varied slightly year to year (ranging from 27.8 ppb to 31.4 ppb between 2010 and 2021), without a consistent trend.
                            </p>
                            <p>Higher levels were consistently measured at sites with lower traffic density and lower NO<sub>2</sub> concentrations such as areas of outer Queens, Brooklyn, and Staten Island, reflecting less removal of ozone from the atmosphere by fresh combustion NO<sub>X</sub> emissions.
                            </p>
                            <p>In summer 2021, seasonal average O<sub>3</sub> varied from 24.3 to 38 ppb across the monitoring sites.
                            </p>
                        </div>

                        <div id="pm25Text" class="polText hide">
                            <p>Citywide, annual average levels of fine particulate matter declined by 40% between 2009 and 2021, an average of 0.4 micrograms per cubic meter per year.
                            </p>
                            <p>Recently, higher levels of PM<sub>2.5</sub> have been seen at sites with nearby commercial cooking grills/charbroilers and traffic emissions. This is largely due to buildings using cleaner fuels for heating and therefore emitting less PM<sub>2.5</sub> than when NYCCAS began monitoring.
                            </p>
                            <p>In 2021, seasonal average PM<sub>2.5</sub> concentrations across NYCCAS monitoring sites ranged from 2.4 to 15.1 micrograms per cubic meter.
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal -->
<div class="modal fade" id="mapModal" tabindex="-1" role="dialog" aria-labelledby="yearsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="yearsModalLabel" data-pagefind-ignore="all">Pollutants: All Years</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
            <div class="row no-gutters mb-1">
                <div class="col-sm-8">
                    <button type="button" class="btn mtBtn btn-sm btn-outline-dark active" value="BC">BC</button>
                    <button type="button" class="btn mtBtn btn-sm btn-outline-dark" value="NO">NO</button>
                    <button type="button" class="btn mtBtn btn-sm btn-outline-dark" value="NO2">NO<sub>2</sub></button>
                    <button type="button" class="btn mtBtn btn-sm btn-outline-dark" value="O3">O<sub>3</sub></button>
                    <button type="button" class="btn mtBtn btn-sm btn-outline-dark" value="PM25">PM<sub>2.5</sub></button>
                    <button type="button" class="btn mtBtn btn-sm btn-outline-dark" value="SO2">SO<sub>2</sub></button>

                </div>

                <div class="col-sm-3 ml-auto">
                    <div class="float-right">
                        <button id="btnPlus" class="btnYearChange btn btn-sm btn-outline-dark" onclick="changeYear(-1)">-</button>
                        <button id="yearPrint" class="font-weight-bold btn btn-sm btn-dark" disabled>2021</button>
                        <button id="btnMinus" class="btnYearChange btn btn-sm btn-outline-dark" onclick="changeYear(1)">+</button>
                    </div>
                </div>



              </div>
    
              <div class="row no-gutters">
                <div class="col-9 mx-auto">
                  <img id="raster" src="embed/map-images/BC_2021.png" style="width:100%; height: auto;">
    
                </div>
              </div>

              <script>
                // update image
                var chosenYear = 2020
                var mtPol = "BC"

                function updateRaster() {
                var filename = mtPol + "_" + chosenYear + ".png"
                // console.log(filename)
                document.getElementById('raster').src = "embed/map-images/" + filename

                }

                // Change var pollutant and polYear on Button Click
                const mtBtns = document.querySelectorAll(".mtBtn ")
                for (var i = 0; i < mtBtns.length; i++) {
                mtBtns[i].addEventListener("click", function() {
                for (let button of mtBtns) button.classList.remove('active');
                this.className += " active";
                mtPol = this.value
                polYear = mtPol+chosenYear
                updateRaster()
                });
                }


                // change year value on button click
                function changeYear(x) {
                    chosenYear = Number(chosenYear)

                    if (chosenYear + Number(x) < 2022 && chosenYear + Number(x) > 2008) {
                        chosenYear = chosenYear + Number(x)
                        polYear = mtPol+chosenYear
                        document.getElementById('yearPrint').innerHTML = chosenYear
                        updateRaster()
                    } else {}

                }


          </script>



        </div>
      </div>
    </div>
  </div>

            <style>
                .show {
                    display: block;
                }

                .hide {
                display: none;
                }
            </style>

            <script>
                const polbtns = document.querySelectorAll('.polbtn')
                var mapPol;
                var embed;
                for (let i = 0; i < polbtns.length; i++) {
                    polbtns[i].addEventListener("click", function() {
                        mapPol = this.value
                        //Turns off highlights on everything based on class
                        for (let button of document.querySelectorAll('.polbtn')) button.classList.remove('active');
                        this.classList.add('active')
                        embed = 'raster/' + this.value + '_2021.html'
                        document.getElementById('iframeEmbed').src = embed;

                        const mapTexts = document.querySelectorAll('.polText')
                        for (let div of document.querySelectorAll('.polText')) div.classList.add('hide')
                        var chosenText = mapPol+'Text'
                        document.getElementById(chosenText).classList.remove('hide')

                    })
                }


            </script>




            <hr>



        </div>
    </div>

    <div class="row mt-4">
        <div class="col-md-8 col-sm-12 mx-auto">
            <!-- Pollutant trends -->
            <h2>Pollutant Trends</h2>
            {{ .Params.pollutantTrends | safeHTML }}
            <hr>
            <div id="pollutantTrendsEmbed">
                <div class="row">
                    <div class="col-12">
                            <div class="">
                                <button type="button" class="btn trpolbtn btn-outline-dark active" value="BC">BC</button>
                                <button type="button" class="btn trpolbtn btn-outline-dark" value="NO">NO</button>
                                <button type="button" class="btn trpolbtn btn-outline-dark" value="NO2">NO<sub>2</sub></button>
                                <button type="button" class="btn trpolbtn  btn-outline-dark" value="O3">O<sub>3</sub></button>
                                <button type="button" class="btn trpolbtn btn-outline-dark" value="PM2.5">PM<sub>2.5</sub></button>
                                <button type="button" class="btn trpolbtn btn-outline-dark" value="SO3">SO<sub>2</sub></button>
                            </div>
                    </div>
              
                    <div class="col-12">
                        <div id="subCont" class="mt-1 mb-2"></div>
                    </div>
                </div>
              
                <div class="row mt-1">
                    <div class="col-12">
                        <p><span class="fs-lg" style="font-weight: bold;"><span id='polPrint' class="">Pollutant</span> by <span id='sourcePrint'>Source</span></span><br>
                        <em><span id="unitPrint" class="fs-sm"></span></em>
                        </p>
                        <div id="vis" style="width: 100%;"></div>
                    </div>
                </div>
                <hr>
              
                <style>
                    .srcbtn {
                    cursor: pointer;}
                    .border {
                        background-color:#6c7287;
                        color: white;
                    }
                </style>
              
                <script>
                      var trendPollutant
                      var source
                      var view; // ssn (season) or ttl (tertile)
                      var sources = [];
                      var units
                      var trendPollutantName
                      
                      // arrays of pollutant-specific sources
                      var bcSources = ['Commercial Cooking', 'Industrial Areas', 'Traffic Density'];
                      var noSources = ['Boiler Density','Traffic NOx Emissions'];
                      var no2Sources = ['Traffic Density', 'Building Density'];
                      var o3Sources = ['Traffic Density'];
                      var pmSources = ['Commercial Cooking','Traffic Density','Boiler PM2.5 Emissions'];
                      var so2Sources = ['Boilers Using Residual Oil','Night-Time Population Density'];
              
                      // SET DEFAULTS
                      trendPollutant = 'BC'
                      trendPollutantName = 'Black Carbon'
                      units = 'micrograms per cubic meter'
                      sources = bcSources 
                      source = sources[0]
                      createSourceButtons()
              
              
                      // GET POLLUTANT AND OTHER VARIABLES ON INITIAL BUTTON CLICK
                      const trbtns = document.querySelectorAll(".trpolbtn")
                      for (var i = 0; i < trbtns.length; i++) {
                          trbtns[i].addEventListener("click", function() {
                            for (let button of document.querySelectorAll('.trpolbtn')) button.classList.remove('active');
                            this.className += " active";
                            trendPollutant = this.value
              
                            // declare sources and units for selected pollutant
                              if (trendPollutant === 'BC') {
                                  sources = bcSources
                                  units = 'micrograms per cubic meter'
                                  trendPollutantName = 'Black Carbon'
                              } else if (trendPollutant === 'NO') {
                                  sources = noSources
                                  units = 'parts per billion'
                                  trendPollutantName = 'Nitric Oxide'
                              } else if (trendPollutant === 'NO2') {
                                  sources = no2Sources
                                  units = 'parts per billion'
                                  trendPollutantName = 'Nitrogen Dioxide'
                              } else if (trendPollutant === 'O3') {
                                  sources = o3Sources
                                  units = 'parts per billion'
                                  trendPollutantName = 'Ozone'
                              } else if (trendPollutant === 'PM2.5') {
                                  sources = pmSources
                                  units = 'micrograms per cubic meter'
                                  trendPollutantName = 'Fine Particles'
                              } else if (trendPollutant = 'SO2') {
                                  sources = so2Sources
                                  units = 'parts per billion'
                                  trendPollutantName = 'Sulfur Dioxide'
                              }
                              source = sources[0]
                              // logMetadata();
              
                              // create buttons for the pollutant's sources
                              createSourceButtons()
                              drawChart();
              
                          });
                        }
              
                      function createSourceButtons() {
                          // loop through Sources and create buttons
                          document.getElementById('subCont').innerHTML = '';
                          for (let i = 0; i < sources.length; i++) {
                              var thisSource = sources[i]
                              var newButton = `<span class="badge srcbtn badge-light mr-1">${thisSource}</span>`
                              document.getElementById('subCont').innerHTML += newButton
                          };
              
                          // loop through newly-added buttons, get first, apply Active state
                          var srcBtns = document.querySelectorAll('.srcbtn')
                          srcBtns[0].classList.add('border')
              
                          // put listener on source buttons
                          for (let x = 0; x < srcBtns.length; x++) {
                              srcBtns[x].addEventListener("click", function() {
                                // remove "active" from classnames
                                var activeSource = document.querySelectorAll('.srcbtn.border')
                                activeSource[0].classList.remove('border')
                                // apply Active to selected source button
                                this.className += " border";
                                source = this.innerHTML;
                                drawChart();
                              })
                          }
                      }
              
                      // re-draw chart on window re-sizing
                      window.onresize = function(event) {
                          drawChart();
                      };
              
                      var chartSpec = {};
                      function drawChart() {
                          document.getElementById('polPrint').innerHTML = trendPollutantName
                          document.getElementById('sourcePrint').innerHTML = source
                          document.getElementById('unitPrint').innerHTML = units
                          let width = document.getElementById('vis').offsetWidth / 2.25
              
                          chartSpec = {
                              "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
                              "title": null,
                              "width": width,
                              "description": "NYCCAS data by season, source, and pollutant",
                              "data": {
                                "url": "embed/pollutant-trends-data.csv"
                              },
                              "config": {
                                  "title": {"anchor": "start", "fontSize": 14},
                                  "axisY": {"title": null},
                                  "axisX": {"title": "Year","grid": false},
                                  "style": {
                                    "cell": {"stroke": "transparent"},
                                    "line": {"stroke": "#1696d2", "strokeWidth": 3},
                                    "text": {"fontSize": 11, "fontWeight": "bold", "size": 11,"align": "left"},
                                    "group-title": {"fontWeight": "normal"}
                                  },
                                  "range": {
                                      "category": [
                                        "#810f7c",
                                        "#b3cde3",
                                        "#8c96c6"
              
                                      ]
                                    },
                                    "legend": {"orient": "bottom"}
                                },
                              "columns": 2,
                              "transform": [
                                {
                                  "filter": `datum.Pollutant === '${trendPollutant}' && datum.Source === '${source}'`
                                }
                              ],
                              "mark": {"type": "line", "point": true},
                              "encoding": {
                                "facet": {
                                  "field": "Season",
                                  "type": "nominal",
                                  "columns": 2,
                                  "title": null,
                                  "sort": ["Winter", "Spring", "Summer", "Fall"],
                                  "header": {"labelFontSize": 15,"labelAlign":"left","labelAnchor": "start"}
                                },
                                "x": {"timeUnit": "utcyear", "field": "Time"},
                                "y": {"field": "Value", "type": "quantitative"},
                                "tooltip": [
                                  {"field": "Value", "title": "Value", "format": ",.1~f"},
                                  {"field": "Tertile", "title": "Tertile"}
                                ],
                                "color": {
                                  "field": "Tertile", 
                                  "type": "nominal"
                                }
                              }
                            };
              
                      vegaEmbed('#vis', chartSpec);
                      }
              
              
              
                      function logMetadata() {
                          console.log('*****METADATA*****')
                          console.log('pollutant: ' + trendPollutant)
                          console.log('sources: ' + sources)
                          console.log('source: ' + source)
                          console.log('units: ' + units)
                      }
              
              
                      drawChart();
                  </script>
              </div>
            
        </div>
    </div>


    <div class="row mt-4">
        <div class="col-md-8 col-sm-12 mx-auto">

            <!-- Pollutant predictors: template -->
            <h2>Pollutant Predictors</h2>
            <p>NYCCAS data were analyzed using a land-use regression (LUR) model. LUR models estimate associations among pollution levels, average traffic, building emissions, land use and other neighborhood factors around the monitoring sites. The pollution sources that contribute most to differences in concentrations of NO, NO<sub>2</sub>, BC, and PM<sub>2.5</sub> across NYC are listed in the table below. SO<sub>2</sub> is now so low in NYC that it is not possible to build a LUR model for the most recent years of data.</p><p>Fuel used to provide heat and hot water in buildings has become significantly cleaner under state and local regulations requiring use of cleaner burning fuels. As a result, commercial charbroiling and grilling operations have become a more important source of PM<sub>2.5</sub> emissions over the past several years. The number of commercial cooking charbroilers and grills in an area now explains PM<sub>2.5</sub> and Black Carbon differences among neighborhoods better than building emissions. For more information on these changes, see <a href="../../../data-stories/aq-cooking/">Tracking changes in New York City's sources of air pollution</a>.</p>

            <hr>
            <div id="pollutantPredictors">
                <div class="row">
                    <div class="col-md-7">
                            <div class="">
                                <button type="button" class="btn srcbtn btn-outline-dark active" onclick="changePollutant('bc')" id="bcbtn" value="bc">BC</button>
                                <button type="button" class="btn srcbtn btn-outline-dark" onclick="changePollutant('no')" id="nobtn" value="no">NO</button>
                                <button type="button" class="btn srcbtn btn-outline-dark" onclick="changePollutant('no2')" id="no2btn" value="no2">NO<sub>2</sub></button>
                                <button type="button" class="btn srcbtn btn-outline-dark" onclick="changePollutant('o3')" id="o3btn" value="o3">O<sub>3</sub></button>
                                <button type="button" class="btn srcbtn btn-outline-dark" onclick="changePollutant('pm')" id="pmbtn" value="pm">PM<sub>2.5</sub></button>
                            </div>
                    </div>
                </div>
        
                <div class="row">
                    <div class="col">
                        <div class="mt-1">
                            <div id="bc" class="polSources">
                                <!--black carbon source info-->
                                <table class="table">
                                    <thead>
                                      <tr>
                                        <th scope="col">Indicator</th>
                                        <th scope="col">Description</th>
                                        <th scope="col">Associated sources and interpretation</th>
                                      </tr>
                                    </thead>
                                    <tbody>
                                      <tr>
                                        <th scope="row">Loading docks</th>
                                        <td>Number of warehouse loading docks within 600 m</td>
                                        <td>Emissions from trucks idling and traveling to and from warehouses</td>
                                      </tr>
                                      <tr>
                                        <th scope="row">Commercial cooking</th>
                                        <td>Number of permitted commercial cooking grills and charbroilers within 100 m</td>
                                        <td>Emissions from commercial cooking</td>
                                      </tr>
                                      <tr>
                                        <th scope="row">Truck and bus traffic density</sub></th>
                                        <td>PM<sub>2.5</sub> emissions from truck and bus traffic within 900 m</td>
                                        <td>PM<sub>2.5</sub> emissions from trucks and buses estimated from emissions rates and vehicle miles traveled </td>
                                      </tr>
                                      <tr>
                                        <th scope="row">Road density</th>
                                        <td>Area of impervious road surface within 100 m</td>
                                        <td>Emissions of motor vehicles on paved roadways</td>
                                      </tr>
                                    </tbody>
                                  </table>
            
                            </div>
            
                            <div id="no" class="polSources hide">
                                <!--NO source buttons -->
                                <table class="table">
                                    <thead>
                                      <tr>
                                        <th scope="col">Indicator</th>
                                        <th scope="col">Description</th>
                                        <th scope="col">Associated sources and interpretation</th>
                                      </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <th scope="row">Loading docks</th>
                                            <td>Number of warehouse loading docks within 600 m</td>
                                            <td>Emissions from trucks idling and traveling to and from warehouses</td>
                                          </tr>
                                      <tr>
                                        <th scope="row">Bus traffic</th>
                                        <td>Location on a bus route (compared to non-bus route locations)</td>
                                        <td>Emissions from buses and other vehicles on busy roadways - indicator of traffic congestion</td>
                                      </tr>
                                      <tr>
                                        <th scope="row">Traffic density</th>
                                        <td>Traffic density, weighted by relative NO<sub>X</sub> emissions rates and vehicle type (car, truck, bus) within 400 m</td>
                                        <td>NO<sub>X</sub> emissions from all on-road motor vehicles based on vehicle miles and the relative emission rates of different vehicle types</td>
                                      </tr>
                                      <tr>
                                        <th scope="row">Impervious surfaces</sub></th>
                                        <td>Percent impervious surface within 100 m</td>
                                        <td>Emissions of motor vehicles on paved roadways</td>
                                      </tr>
        
                                    </tbody>
                                  </table>                    </div>
        
                            <div id="no2" class="polSources hide">
                                <table class="table">
                                    <thead>
                                      <tr>
                                        <th scope="col">Indicator</th>
                                        <th scope="col">Description</th>
                                        <th scope="col">Associated sources and interpretation</th>
                                      </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <th scope="row">Building density</sub></th>
                                            <td>Area of interior building space within 1,000 meters</td>
                                            <td>Combustion of heating oil and natural gas</td>
                                          </tr>

                                        <tr>
                                            <th scope="row">Loading docks</th>
                                            <td>Number of warehouse loading docks within 900 m</td>
                                            <td>Emissions from trucks idling and traveling to and from warehouses</td>
                                          </tr>

                                          <tr>
                                            <th scope="row">Traffic density</th>
                                            <td>Traffic density, weighted by relative NO<sub>X</sub> emissions rates and vehicle type (car, truck, bus) within 1000 m</td>
                                            <td>NO<sub>X</sub> emissions from all on-road motor vehicles based on vehicle miles and the relative emission rates of different vehicle types</td>
                                          </tr>

                                          <tr>
                                            <th scope="row">Impervious surfaces</sub></th>
                                            <td>Percent impervious surface within 100 m</td>
                                            <td>Emissions of motor vehicles on paved roadways</td>
                                          </tr>

                                          <tr>
                                            <th scope="row">Bus traffic</th>
                                            <td>Location on a bus route (compared to non-bus route locations)</td>
                                            <td>Emissions from buses and other vehicles on busy roadways - indicator of traffic congestion</td>
                                          </tr>

        
                                    </tbody>
                                  </table> 
        
                            </div>
        
                            <div id="o3" class="polSources hide">
                                <table class="table">
                                    <thead>
                                      <tr>
                                        <th scope="col">Indicator</th>
                                        <th scope="col">Description</th>
                                        <th scope="col">Associated sources and interpretation</th>
                                      </tr>
                                    </thead>
                                    <tbody>
                                      <tr>
                                        <th scope="row">NO<sub>2</sub></th>
                                        <td>Level of NO<sub>2</sub> measured at the same location</td>
                                        <td>Nitric oxides (NO<sub>x</sub>) at elevated concentrations react with ground-level ozone (O<sub>3</sub>) to create NO<sub>2</sub> and O<sub>3</sub>, also called "quenching ozone."</td>
                                      </tr>
                                      <tr>
                                        <th scope="row">Tree cover</th>
                                        <td>Tree cover within 50 m</td>
                                        <td>Reduced levels thorugh reactions of ozone with leaf surfaces.</td>
                                      </tr>
                                    </tbody>
                                  </table> 
                            </div>
        
                            <div id="pm" class="polSources hide">
                                <table class="table">
                                    <thead>
                                      <tr>
                                        <th scope="col">Indicator</th>
                                        <th scope="col">Description</th>
                                        <th scope="col">Associated sources and interpretation</th>
                                      </tr>
                                    </thead>
                                    <tbody>
                                      <tr>
                                        <th scope="row">Commercial cooking</th>
                                        <td>Number of permitted commercial cooking grills and charbroilers within 1,000 meters</td>
                                        <td>Emissions from commercial cooking.</td>
                                      </tr>

                                      <tr>
                                        <th scope="row">Loading docks</th>
                                        <td>Number of warehouse loading docks within 600 m</td>
                                        <td>Emissions from trucks idling and traveling to and from warehouses</td>
                                      </tr>

                                      <tr>
                                        <th scope="row">Traffic density</th>
                                        <td>Weighted by relative PM<sub>2.5</sub> emissions rates by vehicle type (car, truck, bus) within 250 meters</td>
                                        <td>PM<sub>2.5</sub> emissions from all on-road motor vehicle based on vehicle miles and the relative emissions rates of different vehicle types</td>
                                      </tr>

                                    </tbody>
                                  </table> 
        
                            </div>
        
                        </div>
                    </div>
                </div>
                <hr>

                <script>
                    function changePollutant(x) {
                        var pollutant = x;
                        console.log('pollutant: ')
                        console.log(x)

                        // remove active classes from .polbtn
                        const btns = document.querySelectorAll(".srcbtn")
                        for (var i = 0; i < btns.length; i++) {
                            btns[i].classList.remove('active')
                        }

                        // add active class to x+btn
                        console.log(x + 'btn')
                        document.getElementById(x+'btn').classList.add('active')

                        // show/hide subbuttons
                        var subButtons = document.getElementsByClassName("polSources");
                        for (let i = 0; i < subButtons.length; i ++ ) {
                        subButtons[i].classList.add('hide')

                        // show the selected one
                        document.getElementById(x).classList.remove('hide')
                    }
                    }
                </script>
            </div>

        </div>
    </div>

    <!-- Conclusion and more info -->
    <div class="row my-2">
        <div class="col-sm-8 mx-auto col-xs-12">
            <h2>Conclusion</h2>
            {{ .Params.conclusion | safeHTML }}
            <hr>
            <div class="greenleftborder mb-4">
                <strong>More information</strong>
                {{ .Params.moreInfo | safeHTML }}
                </div>

        </div>
    </div>





</article>

{{- end -}}